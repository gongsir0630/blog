<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ä½¿ç”¨ Travis æ‰“é€  SpringBoot åº”ç”¨æŒç»­é›†æˆå’Œè‡ªåŠ¨éƒ¨ç½² | Travis CI åˆä½“éªŒ</title>
      <link href="/blog/2021/04/02/travis-ci-springboot.html"/>
      <url>/blog/2021/04/02/travis-ci-springboot.html</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘ä¸€ç›´åœ¨å†™æ¯•è®¾é¡¹ç›®ï¼ˆ<a href="https://github.com/gongsir0630/campus-recruitment-guidance">æŸšå­å¸®æ ¡æ‹›æŒ‡å¯¼æœåŠ¡å¹³å°</a>ï¼‰ï¼Œé¡ºä¾¿æ•´ç†äº†ä¸€ä¸‹è‡ªå·± <a href="https://github.com/gongsir0630">GitHub</a> ä¸Šçš„é¡¹ç›®ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f3066c64416408db5d7a593fc125062~tplv-k3u1fbpfcp-watermark.image" alt="My GitHub HomePage"></p><p>å¤§å­¦è¿™å‡ å¹´ï¼Œè¿˜æ˜¯å†™äº†ä¸€äº›èƒ½ä¸Šç®€å†çš„é¡¹ç›®ï¼Œæ¯ä¸€ä¸ªé¡¹ç›®éƒ½æ˜¯ <code>Pm-&gt;Dev-&gt;Op</code> è¿›è¡Œè§’è‰²æ‰®æ¼”ï¼Œç‰¹åˆ«æ˜¯ä»å¼€å‘åˆ°è¿ç»´éƒ¨ç½²è¿™ä¸€é˜¶æ®µï¼Œ ä»¥å‰æ¯æ¬¡çš„ç‰ˆæœ¬è¿­ä»£éƒ½è¦é‡å¤ä¸‹é¢çš„æµç¨‹ï¼š</p><ul><li>git add &amp;&amp; git commit &amp;&amp; git push -&gt; â‘ ä»£ç çš„è¿­ä»£</li><li>mvn clean package -&gt; â‘¡é¡¹ç›®æ‰“åŒ…</li><li>scp -r target/xxx.jar user@host:/dir/xxx.jar -&gt; â‘¢ä¸Šä¼ åº”ç”¨åˆ°æœåŠ¡å™¨</li><li>ssh user@host -&gt; â‘£ç™»å½•æœåŠ¡å™¨</li><li>sh restart.sh -&gt; â‘¤æ‰§è¡Œéƒ¨ç½²è„šæœ¬</li><li>å‘ç°bug -&gt; ä¿®æ”¹ä»£ç  -&gt; goto â‘ </li></ul><p>å¦‚æœä½ ä¹Ÿæœ‰ç±»ä¼¼ç»å†ï¼Œä¸€å®šä¼šæ·±æ„Ÿ<strong>æŒç»­é›†æˆ</strong>çš„å¿…è¦æ€§ï¼Œå› ä¸ºæ‰‹åŠ¨éƒ¨ç½²å®åœ¨åˆç¹çåˆè€—æ—¶ï¼Œè™½ç„¶éƒ¨ç½²æµç¨‹åŸºæœ¬å›ºå®šï¼Œä¾ç„¶è¿˜æ˜¯å®¹æ˜“å‡ºé”™ã€‚</p><h2 id="æŒç»­é›†æˆ"><a href="#æŒç»­é›†æˆ" class="headerlink" title="æŒç»­é›†æˆ"></a>æŒç»­é›†æˆ</h2><p>å¦‚æœä½ å¾ˆç†Ÿæ‚‰<strong>æŒç»­é›†æˆ</strong>ï¼Œä¸€å®šä¼šåŒæ„è¿™æ ·çš„è§‚ç‚¹ï¼šã€Œä½¿ç”¨å®ƒå·²ç»æˆä¸ºä¸€ç§æ ‡é…ã€ã€‚</p><p>å¦‚æœä½ è¿˜ä¸äº†è§£<strong>æŒç»­é›†æˆ</strong>ï¼Œè¿™é‡Œå¯ä»¥<a href="https://www.ruanyifeng.com/blog/2015/09/continuous-integration.html">å¿«é€Ÿå…¥é—¨</a>ã€‚</p><p>å¸‚åœºä¸ŠæŒç»­é›†æˆå·¥å…·ä¼—å¤š(Jenkinsã€Travis CIã€Gitlab CI)ï¼Œä¹Ÿæœ‰å¾ˆå¤šäº‘å¹³å°é›†æˆäº† CI/CID æœåŠ¡ï¼ˆCodingã€é˜¿é‡Œäº‘æ•ˆç­‰ï¼‰ã€‚</p><p>ä¹‹å‰æˆ‘ä½“éªŒè¿‡ <a href="https://e.coding.net/">Coding</a> å¹³å°çš„æŒç»­é›†æˆ-æ„å»ºè®¡åˆ’ï¼Œç”¨äºéƒ¨ç½²æˆ‘è‡ªå·±çš„åšå®¢ï¼Œç›¸å…³æ–‡ç« å’Œæ•™ç¨‹ä¹Ÿå‘å¸ƒåœ¨è‡ªå·±çš„åšå®¢ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç‚¹å‡»<a href="https://blog.gongsir.club/">ä¼ é€é—¨</a>å­¦ä¹ ã€‚</p><p>æœ€è¿‘æ•´ç† Github é¡¹ç›®ï¼Œå°±æƒ³ç€ä½“éªŒä¸€ä¸‹ä½¿ç”¨ Travis CI æ¥å®ç°é¡¹ç›®çš„ CIï¼ŒæŠ˜è…¾äº†ä¸€å¤©ï¼Œæ— å¥ˆå›½å†… Travis æ–‡æ¡£ç¨€ç¼ºï¼Œè¸©äº†å¾ˆå¤šå‘ï¼Œæ‰€ä»¥æ‰æ¥å†™äº†è¿™ç¯‡æ–‡ç« ï¼Œå¸Œæœ›å’ŒåŒå­¦ä»¬ç›¸äº’åˆ†äº«ã€å­¦ä¹ ï¼</p><h2 id="æ­£æ–‡å¼€å§‹"><a href="#æ­£æ–‡å¼€å§‹" class="headerlink" title="æ­£æ–‡å¼€å§‹"></a>æ­£æ–‡å¼€å§‹</h2><h3 id="éœ€æ±‚"><a href="#éœ€æ±‚" class="headerlink" title="éœ€æ±‚"></a>éœ€æ±‚</h3><p>è¦å®ç° CIï¼Œé¦–å…ˆå¾—æœ‰ä¸€ä¸ªé¡¹ç›®ï¼Œæœ¬æ–‡ä½¿ç”¨çš„é¡¹ç›®ï¼š<a href="https://github.com/gongsir0630/wx-java-miniapp">gongsir0630/wx-java-miniapp</a></p><p>é¡¹ç›®åŸºäº Spring-Boot æ­å»ºï¼Œå¯ä»¥é€šè¿‡ Maven æ‰“åŒ…è¿è¡Œã€‚</p><p>è¿™é‡Œæˆ‘å¸Œæœ›æ¯æ¬¡æäº¤ä»£ç åˆ°è¿œç¨‹ä»“åº“åï¼Œtravis ä¼šè‡ªåŠ¨ç¼–è¯‘æ‰“åŒ…é¡¹ç›®ï¼Œå¹¶ä¸Šä¼ åˆ°æˆ‘çš„æœåŠ¡å™¨ï¼Œæ‰§è¡Œéƒ¨ç½²è„šæœ¬ï¼Œä»¥å®ç°é¡¹ç›®è‡ªåŠ¨éƒ¨ç½²ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ä¿®æ”¹ä»£ç </li><li>git æäº¤åˆ°è¿œç¨‹ä»“åº“</li><li>travis æ£€æµ‹ä»“åº“å˜åŠ¨ï¼Œæ‰§è¡Œ <code>.travis.yml</code> ä¸­çš„ä»»åŠ¡</li><li>maven ç¼–è¯‘æ‰“åŒ…</li><li>ä¸Šä¼  jar åˆ°æˆ‘çš„äº‘æœåŠ¡å™¨</li><li>è¿œç¨‹æ‰§è¡Œéƒ¨ç½²è„šæœ¬</li><li>é‚®ä»¶é€šçŸ¥</li></ul><h3 id="GitHub-æˆæƒ"><a href="#GitHub-æˆæƒ" class="headerlink" title="GitHub æˆæƒ"></a>GitHub æˆæƒ</h3><p>è¿›å…¥<a href="https://www.travis-ci.com/">Travis å®˜ç½‘</a>ï¼Œç›´æ¥ä½¿ç”¨ Github è´¦å·ç™»å½•ï¼Œç™»å…¥æˆåŠŸä¹‹åï¼Œæ ¹æ®é¡µé¢å¼•å¯¼å¼€é€š GitHub ä»“åº“è®¿é—®æˆæƒï¼Œåœ¨ <a href="https://www.travis-ci.com/dashboard">Dashboard</a> å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„æˆæƒä»“åº“ï¼Œå¯ä»¥ç»™å¸¸ç”¨ä»“åº“åŠ æ˜Ÿæ ‡æ–¹ä¾¿è®¿é—®ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4fbd78b8d99414b8ba448eb0cd5973a~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><blockquote><p>æ³¨æ„ Travis ç›®å‰æœ‰ä¸¤ä¸ªå®˜ç½‘ï¼š<a href="https://www.travis-ci.com/">travis-ci.com</a> å’Œ <a href="https://www.travis-ci.org/">travis-ci.org</a>. å®˜æ–¹é€šçŸ¥åè€…å³å°†å…³é—­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨å‰è€…ã€‚</p></blockquote><h3 id="å¼€å¯é¡¹ç›®ç›‘æ§"><a href="#å¼€å¯é¡¹ç›®ç›‘æ§" class="headerlink" title="å¼€å¯é¡¹ç›®ç›‘æ§"></a>å¼€å¯é¡¹ç›®ç›‘æ§</h3><p>åœ¨ <a href="https://www.travis-ci.com/dashboard">Dashboard</a> é¡µé¢é€‰æ‹©æƒ³è¦å¼€å¯ travis åŠŸèƒ½çš„ä»“åº“ï¼Œç‚¹å‡»<code>Trigger a build</code>å³å¯å¼€å¯å¯¹è¯¥ä»“åº“çš„ç›‘å¬ï¼Œtravis ä¸€æ—¦ç›‘å¬åˆ°ä»“åº“å˜åŠ¨ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘æ„å»ºä»»åŠ¡ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/73aebcdc54dc4238aa9923452bd60101~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h3 id="travis-é…ç½®æ–‡ä»¶"><a href="#travis-é…ç½®æ–‡ä»¶" class="headerlink" title="travis é…ç½®æ–‡ä»¶"></a>travis é…ç½®æ–‡ä»¶</h3><p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ <code>.travis.yml</code>æ–‡ä»¶ï¼Œè¿™é‡Œé—®é¢˜æ¯”è¾ƒå¤šï¼Œå…ˆä¸ŠæˆåŠŸæ¡ˆä¾‹ä»£ç ï¼Œå†æ…¢æ…¢è§£é‡Šï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">language:</span> <span class="string">java</span></span><br><span class="line"><span class="attr">os:</span> <span class="string">linux</span></span><br><span class="line"><span class="attr">dist:</span> <span class="string">xenial</span></span><br><span class="line"><span class="attr">jdk:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">openjdk8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">addons:</span></span><br><span class="line">  <span class="attr">ssh_known_hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="number">39.106</span><span class="number">.230</span><span class="number">.88</span></span><br><span class="line"></span><br><span class="line"><span class="attr">script:</span> <span class="string">mvn</span> <span class="string">clean</span> <span class="string">package</span> <span class="string">-Dmaven.test.skip=true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">after_success:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">scp</span> <span class="string">-o</span> <span class="string">stricthostkeychecking=no</span> <span class="string">-r</span> <span class="string">target/wx-java-miniapp-0.0.1-SNAPSHOT.jar</span> <span class="string">travis@yzhelp.top:/www/wwwroot/travis-app/wx-java-miniapp</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">ssh</span> <span class="string">travis@yzhelp.top</span> <span class="string">-o</span> <span class="string">stricthostkeychecking=no</span> <span class="string">&quot;sh /www/wwwroot/travis-app/wx-java-miniapp/restart.sh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">branches:</span></span><br><span class="line">  <span class="attr">only:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">notifications:</span></span><br><span class="line">  <span class="attr">email:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gongsir0630@gmail.com</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">openssl</span> <span class="string">aes-256-cbc</span> <span class="string">-K</span> <span class="string">$encrypted_f217180e22ee_key</span> <span class="string">-iv</span> <span class="string">$encrypted_f217180e22ee_iv</span></span><br><span class="line">  <span class="string">-in</span> <span class="string">id_rsa.enc</span> <span class="string">-out</span> <span class="string">~/.ssh/id_rsa</span> <span class="string">-d</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">echo</span> <span class="string">-e</span> <span class="string">&quot;Host yzhelp.top\n\tStrictHostKeyChecking no\n&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/config</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é…ç½®æ€è·¯ï¼š</p><ol><li>ç›‘æµ‹<code>main</code>åˆ†æ”¯å˜åŠ¨ï¼Œè§¦å‘æ„å»ºï¼›</li><li>é…ç½® ssh å…å¯†ç™»å½•è‡ªå·±çš„äº‘æœåŠ¡å™¨ï¼›</li><li>maven é¡¹ç›®æ‰“åŒ…ï¼›</li><li>scp ä¸Šä¼  jar æ–‡ä»¶åˆ°è¿è´¹æœåŠ¡å™¨ï¼ˆå…å¯†æ“ä½œï¼‰ï¼›</li><li>ssh è¿œç¨‹æ‰§è¡Œ<code>restart.sh</code>éƒ¨ç½²è„šæœ¬ã€‚</li></ol><blockquote><p><strong>æ³¨æ„</strong> æœ¬æ–‡ä¸ä»‹ç» travis æ–‡ä»¶ç¼–å†™æ–¹æ³•ï¼Œå› ä¸ºæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å­¦ä¹ ï¼Œå»ºè®®åŒå­¦åˆ°å®˜ç½‘å…ˆäº†è§£ä¸€ä¸‹ç›¸å…³é…ç½®å’Œæ‰§è¡Œå‘¨æœŸã€‚</p></blockquote><h4 id="é…ç½®-ssh-å…å¯†ç™»å½•"><a href="#é…ç½®-ssh-å…å¯†ç™»å½•" class="headerlink" title="é…ç½® ssh å…å¯†ç™»å½•"></a>é…ç½® ssh å…å¯†ç™»å½•</h4><p>åœ¨ travis æ„å»ºä»»åŠ¡ä¸­ä¸èƒ½è¿›è¡Œå‘½ä»¤äº¤äº’ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ssh å‘½ä»¤å…å¯†ç™»å½•è‡ªå·±çš„æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦å…ˆç”Ÿæˆå¯†é’¥å¯¹ï¼Œåœ¨æœ¬åœ°ç”Ÿæˆç§˜é’¥å¯¹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä¼šåœ¨<code>~/.ssh/</code>ç›®å½•ä¸‹ç”Ÿæˆ<code>id_rsa</code>å’Œ<code>id_rsa.pub</code>ä¸¤ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>å°†å…¬é’¥<code> id_rsa.pub</code>ä½¿ç”¨<code>ssh-copy-id</code>æ·»åŠ åˆ°æœåŠ¡å™¨çš„å—ä¿¡åˆ—è¡¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id -i id_rsa.pub root@hostname</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹æœ¬åœ°<code>~/.ssh/config</code>æ–‡ä»¶ï¼Œè¿½åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># è¿œç¨‹ä¸»æœºåç§°</span><br><span class="line"><span class="title class_">Host</span> yzhelp.<span class="property">top</span></span><br><span class="line"># è¿œç¨‹ä¸»æœºåŸŸåæˆ–è€… ip åœ°å€</span><br><span class="line"><span class="title class_">HostName</span> yzhelp.<span class="property">top</span></span><br><span class="line"># è®¤è¯æ–¹å¼</span><br><span class="line"><span class="title class_">PreferredAuthentications</span> publickey</span><br><span class="line"># ç§é’¥ä½ç½®</span><br><span class="line"><span class="title class_">IdentityFile</span> /<span class="title class_">Users</span>/gongsir/.<span class="property">ssh</span>/id_rsa_yzhelp</span><br><span class="line"># ç”¨æˆ·å</span><br><span class="line"><span class="title class_">User</span> root</span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong> å¦‚æœä½ æœ¬æœºåªæœ‰ä¸€å¯¹ç§˜é’¥å¯¹ï¼Œå¯ä»¥ä¸ç”¨ä¸Šè¿°é…ç½®ï¼Œå¦‚æœæœ‰å¤šå¯¹ç§˜é’¥å¯¹ï¼Œå¿…é¡»è¿›è¡Œä¸Šè¿°é…ç½®ï¼Œå¦åˆ™ç™»å½•æ—¶ç§˜é’¥ä¸ä¼šé…å¯¹ã€‚</p></blockquote><p>æµ‹è¯•å…å¯†ç™»å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@hostname</span><br></pre></td></tr></table></figure><p>è¿™åªæ˜¯æˆ‘ä»¬è‡ªå·±çš„ç”µè„‘å¯ä»¥å…å¯†ç™»å½•åˆ°æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® travis çš„æœåŠ¡å™¨å¯ä»¥å…å¯†ç™»å½•åˆ°æˆ‘ä»¬çš„äº‘æœåŠ¡å™¨ï¼Œå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠæˆ‘ä»¬æœ¬åœ°çš„ç§é’¥<code>id_rsa</code>å¤åˆ¶ä¸€ä»½ç»™ travis çš„æœåŠ¡å™¨å°±å¯ä»¥äº†ã€‚</p><p>ä½†æ˜¯ç›´æ¥æŠŠç§é’¥å…¬å¸ƒå‡ºå»å¤ªå±é™©äº†ï¼Œtravis ç»™æˆ‘ä»¬æä¾›äº†è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>åœ¨æœ¬åœ°ä½¿ç”¨<code>travis-cli</code>å·¥å…·å¯¹æ–‡ä»¶è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆ<code>*.enc</code>æ–‡ä»¶</li><li>å°†è§£å¯†ä¸²å†™å…¥ travis ç½‘ç«™çš„ç¯å¢ƒå˜é‡ä¸­</li><li>æ‰§è¡Œæ„å»ºä»»åŠ¡æ—¶ï¼Œä½¿ç”¨è§£å¯†ä¸²å¯¹åŠ å¯†æ–‡ä»¶è¿›è¡Œè§£å¯†å³å¯å¾—åˆ°åŸæ–‡ä»¶</li></ul><h4 id="æ–‡ä»¶åŠ å¯†"><a href="#æ–‡ä»¶åŠ å¯†" class="headerlink" title="æ–‡ä»¶åŠ å¯†"></a>æ–‡ä»¶åŠ å¯†</h4><p>ä¸å¤šè¯´ï¼Œå®˜ç½‘æœ‰è¯¦ç»†æ–‡æ¡£ï¼Œç›´æ¥ä¸Šæ­¥éª¤ã€‚</p><p>æœ¬åœ°å®‰è£…<code>travis-cli</code>å·¥å…·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install travis</span><br></pre></td></tr></table></figure><p>ç™»å½• travisï¼Œè¿™é‡Œå‘å°±æ¯”è¾ƒå¤šäº†ï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>æç¤ºä¿¡æ¯</th><th>çŠ¶æ€</th></tr></thead><tbody><tr><td><code>travis login --auto</code></td><td>æç¤ºè¾“å…¥ GitHub çš„è´¦å·å¯†ç ï¼Œç™»å½•å¤±è´¥</td><td>âŒ Not Found</td></tr><tr><td><code>travis login --github-token token</code></td><td>ç™»å½•æˆåŠŸï¼Œä½†æ˜¯åç»­æ“ä½œä¼šæç¤º token å¤±æ•ˆ</td><td>âœ… å¯ä»¥ç™»å½•ï¼Œä½†æ˜¯æ–‡ä»¶åŠ å¯†ä¼šæç¤º token æ— æ•ˆ</td></tr><tr><td><code>travis login --github-token token --pro</code></td><td>ç™»å½•æˆåŠŸ</td><td>âœ… ç™»é™†æˆåŠŸ</td></tr></tbody></table><p>è¿™ä¸ªç¯èŠ‚æŠ˜è…¾äº†å¤§æŠŠæ—¶é—´ï¼Œç½‘ä¸Šä¹Ÿæ²¡æ‰¾åˆ°å…·ä½“è§£å†³æ–¹æ³•ï¼Œè¿™é‡Œè¯´ä¸‹æµç¨‹ï¼š</p><ul><li><code>travis-cli</code> é»˜è®¤ç™»å½•çš„æ˜¯ <a href="https://api.travis-ci.org/">ttps://api.travis-ci.org/</a></li><li>è€Œæˆ‘ä»¬æˆæƒçš„æ˜¯ <a href="https://api.travis-ci.com/">ttps://api.travis-ci.com/</a></li><li>å› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨ç¬¬ä¸‰ç§ç™»å½•æ–¹å¼ï¼Œå³åŠ ä¸Š <code>--pro</code> é€‰é¡¹ï¼Œæ­¤æ—¶æ‰€æœ‰è¯·æ±‚éƒ½å‘å‘ <a href="https://api.travis-ci.com/">ttps://api.travis-ci.com/</a></li></ul><p>æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹æœ¬åœ°çš„ <code>~/.travis/config</code> ç¡®è®¤apiï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f0c0d58d19d1446cb7a5df86143289db~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>ç™»é™†æˆåŠŸä¹‹åï¼Œå¯¹<code>id_rsa</code>è¿›è¡ŒåŠ å¯†ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ­¤å¤„çš„--addå‚æ•°è¡¨ç¤ºè‡ªåŠ¨æ·»åŠ è„šæœ¬åˆ°.travis.ymlæ–‡ä»¶ä¸­</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä¹Ÿéœ€è¦åŠ ä¸Š --pro é€‰é¡¹</span></span><br><span class="line">travis encrypt-file ~/.ssh/id_rsa --add --pro</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤ï¼Œä¼šäº§ç”Ÿçš„ç»“æœï¼š</p><ul><li><p>æœ¬åœ°æ–°å¢<code>id_rsa.enc</code>ï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªæ–‡ä»¶ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ä¾› travis ä½¿ç”¨</p></li><li><p><code>.travis.yml</code>æ–‡ä»¶ä¸­ä¼šå¢åŠ ç±»ä¼¼å†…å®¹ï¼š</p>  <figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">before_install:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">openssl</span> <span class="string">aes-256-cbc</span> <span class="string">-K</span> <span class="string">$encrypted_f217180e22ee_key</span> <span class="string">-iv</span> <span class="string">$encrypted_f217180e22ee_iv</span></span><br><span class="line">  <span class="string">-in</span> <span class="string">id_rsa.enc</span> <span class="string">-out</span> <span class="string">id_rsa</span> <span class="string">-d</span></span><br></pre></td></tr></table></figure><ul><li><code>-in</code> è¡¨ç¤ºè¾“å…¥æ–‡ä»¶ï¼Œå³æˆ‘ä»¬è¦è§£å¯†çš„æ–‡ä»¶</li><li><code>-out</code> è¡¨ç¤ºè§£å¯†åçš„æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å°†è·¯å¾„ä¿®æ”¹ä¸º <code>~/.ssh/id_rsa</code></li></ul></li><li><p>travis ä»“åº“ä¸­ä¼šæ–°å¢ä¸¤ä¸ªç¯å¢ƒå˜é‡</p><p>  <img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1b52ad2fd858454a8d3b17792015ac78~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p></li></ul><p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œtravis æœåŠ¡å™¨æˆåŠŸè·å–åˆ°æˆ‘ä»¬çš„ç§˜é’¥æ–‡ä»¶<code>id_rsa</code>ï¼Œä¸ºäº†ä¿è¯åé¢èƒ½æˆåŠŸæ‰§è¡Œ ssh å…å¯†ç™»å½•ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦é…ç½®ä¸€ä¸‹æƒé™å’Œä¸»æœºè®¤è¯ä½¿ç”¨çš„ç§˜é’¥æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">addons:</span></span><br><span class="line">  <span class="attr">ssh_known_hosts:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">è¿™é‡Œå†™è‡ªå·±çš„æœåŠ¡å™¨çš„åŸŸåæˆ–</span> <span class="string">ip</span> <span class="string">åœ°å€</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">before_install:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">openssl</span> <span class="string">aes-256-cbc</span> <span class="string">-K</span> <span class="string">$encrypted_f217180e22ee_key</span> <span class="string">-iv</span> <span class="string">$encrypted_f217180e22ee_iv</span></span><br><span class="line">  <span class="string">-in</span> <span class="string">id_rsa.enc</span> <span class="string">-out</span> <span class="string">~/.ssh/id_rsa</span> <span class="string">-d</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">echo</span> <span class="string">-e</span> <span class="string">&quot;Host è‡ªå·±çš„æœåŠ¡å™¨åŸŸåæˆ– ip åœ°å€\n\tStrictHostKeyChecking no\n&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/config</span></span><br></pre></td></tr></table></figure><h4 id="é¡¹ç›®æ‰“åŒ…"><a href="#é¡¹ç›®æ‰“åŒ…" class="headerlink" title="é¡¹ç›®æ‰“åŒ…"></a>é¡¹ç›®æ‰“åŒ…</h4><p>é…ç½® <code>script</code> å³å¯ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">script:</span> <span class="string">mvn</span> <span class="string">clean</span> <span class="string">package</span> <span class="string">-Dmaven.test.skip=true</span></span><br></pre></td></tr></table></figure><h4 id="ä¸Šä¼ éƒ¨ç½²"><a href="#ä¸Šä¼ éƒ¨ç½²" class="headerlink" title="ä¸Šä¼ éƒ¨ç½²"></a>ä¸Šä¼ éƒ¨ç½²</h4><p>ä½¿ç”¨ scp å‘½ä»¤ä¸Šä¼  jar æ–‡ä»¶åˆ°æœåŠ¡å™¨æŒ‡å®šç›®å½•ï¼ˆé¢„å…ˆåˆ›å»ºï¼‰ï¼Œå¹¶æ‰§è¡Œéƒ¨ç½²è„šæœ¬ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">after_success:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">scp</span> <span class="string">-o</span> <span class="string">stricthostkeychecking=no</span> <span class="string">-r</span> <span class="string">target/wx-java-miniapp-0.0.1-SNAPSHOT.jar</span> <span class="string">travis@yzhelp.top:/www/wwwroot/travis-app/wx-java-miniapp</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">ssh</span> <span class="string">travis@yzhelp.top</span> <span class="string">-o</span> <span class="string">stricthostkeychecking=no</span> <span class="string">&quot;sh /www/wwwroot/travis-app/wx-java-miniapp/restart.sh&quot;</span></span><br></pre></td></tr></table></figure><p>éƒ¨ç½²è„šæœ¬ï¼ˆæä¾›å‚è€ƒï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br><span class="line"></span><br><span class="line">jarName=/www/wwwroot/travis-app/wx-java-miniapp/wx-java-miniapp-0.0.1-SNAPSHOT</span><br><span class="line"></span><br><span class="line">ps -ef|grep <span class="variable">$&#123;jarName&#125;</span>.jar|grep -v grep|awk <span class="string">&#x27;&#123;print &quot;kill -9 &quot;$2&#125;&#x27;</span>|sh</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;stop sucess&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">nohup</span> java -jar <span class="variable">$&#123;jarName&#125;</span>.jar &gt; <span class="variable">$&#123;jarName&#125;</span>.<span class="built_in">log</span> 2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;jarName&#125;</span>.jar deploy sucess&quot;</span></span><br></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong> è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œéƒ¨ç½²è„šæœ¬ä¸­åŒ…å« <code>nohup</code> å‘½ä»¤ï¼Œä¸€å®šè¦åœ¨è„šæœ¬ç¬¬ä¸€è¡Œå£°æ˜ <code>source /etc/profile</code>ï¼Œå¦åˆ™ ssh è·å–ä¸åˆ°ç¯å¢ƒå˜é‡ï¼Œå¯¼è‡´éƒ¨ç½²å¤±è´¥ã€‚</p></blockquote><h4 id="é‚®ä»¶é€šçŸ¥"><a href="#é‚®ä»¶é€šçŸ¥" class="headerlink" title="é‚®ä»¶é€šçŸ¥"></a>é‚®ä»¶é€šçŸ¥</h4><p>travis æ„å»ºå®Œæˆä¹‹åï¼Œæ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ä¼šé‚®ä»¶é€šçŸ¥ä½ ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">notifications:</span></span><br><span class="line">  <span class="attr">email:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gongsir0630@gmail.com</span></span><br></pre></td></tr></table></figure><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>æäº¤ travis è§„åˆ™åˆ°è¿œç¨‹ä»“åº“ï¼Œè¿›å…¥ travis å®˜ç½‘å³å¯çœ‹åˆ°æ„å»ºæ—¥å¿—ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b710401a479b42e4813cfd53cf0499f9~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>ç‚¹å‡»é¡¶éƒ¨çš„å¾½ç« è¿˜å¯ä»¥å¤åˆ¶ md æ ¼å¼æ·»åŠ åˆ°ä½ çš„ readme æ–‡ä»¶ä¸­ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fd6ab71c767344bebfdf9aa0cae6e78a~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h2 id="æ€»ç»“-amp-ç›¸å…³é“¾æ¥"><a href="#æ€»ç»“-amp-ç›¸å…³é“¾æ¥" class="headerlink" title="æ€»ç»“ &amp; ç›¸å…³é“¾æ¥"></a>æ€»ç»“ &amp; ç›¸å…³é“¾æ¥</h2><p>ä»¥ä¸Šå°±æ˜¯ä½¿ç”¨ Travis æ‰“é€  SpringBoot åº”ç”¨æŒç»­é›†æˆå’Œè‡ªåŠ¨éƒ¨ç½²çš„å…¨è¿‡ç¨‹ï¼Œå¸Œæœ›èƒ½å’Œå¤§å®¶ä¸€èµ·åˆ†äº«å­¦ä¹ ï¼Œå¦‚æœå¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¿˜è¯·ç‚¹ä¸ªèµæ”¯æŒä¸€ä¸‹ï¼Œè°¢è°¢ï¼</p><p>ç›¸å…³é“¾æ¥ï¼š</p><ul><li><a href="https://github.com/gongsir0630/wx-java-miniapp">ç¤ºä¾‹é¡¹ç›® | wx-java-miniapp</a></li><li><a href="https://docs.travis-ci.com/">Travis å®˜ç½‘æ–‡æ¡£</a></li><li><a href="https://juejin.cn/post/6844903808758185998">å‚è€ƒæ–‡ç« ï¼šç”¨ Travis CI æ‰“é€ å¤§å‰ç«¯æŒç»­é›†æˆå’Œè‡ªåŠ¨åŒ–éƒ¨ç½²</a></li><li><a href="https://juejin.cn/post/6844903957215576078">å‚è€ƒæ–‡ç« ï¼šåˆ©ç”¨Travis CI+GitHubå®ç°æŒç»­é›†æˆå’Œè‡ªåŠ¨éƒ¨ç½²</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸåˆ› </category>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Travis CI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŸºäºShiro | JWTæ•´åˆWxJavaå®ç°å¾®ä¿¡å°ç¨‹åºç™»å½•</title>
      <link href="/blog/2021/03/26/shiro-jwt-demo.html"/>
      <url>/blog/2021/03/26/shiro-jwt-demo.html</url>
      
        <content type="html"><![CDATA[<p>æ˜é‡‘åŸæ–‡ä½“éªŒæ›´åŠ <a href="https://juejin.cn/post/6942706988534988836">ğŸ‘‰ğŸ‘‰æˆ³è¿™é‡Œ</a></p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨åšæ¯•ä¸šè®¾è®¡ï¼Œæ¶‰åŠåˆ°å¾®ä¿¡å°ç¨‹åºçš„å¼€å‘ï¼Œè¦æ±‚å‰ç«¯å°ç¨‹åºç”¨æˆ·ä½¿ç”¨å¾®ä¿¡èº«ä»½ç™»å½•ï¼Œç™»é™†æˆåŠŸåï¼Œåå°è¿”å›è‡ªå®šä¹‰ç™»å½•çŠ¶æ€tokenç»™å°ç¨‹åºï¼Œåç»­å°ç¨‹åºå‘é€APIè¯·æ±‚éƒ½éœ€è¦æºå¸¦tokenæ‰èƒ½è®¿é—®åå°æ•°æ®ã€‚</p><p>æœ¬æ–‡æ˜¯å¯¹æ¥å¾®ä¿¡å°ç¨‹åºï¼Œå®ç°è‡ªå®šä¹‰ç™»å½•çŠ¶æ€çš„ä¸€ä¸ªå®Œæ•´ç¤ºä¾‹ï¼Œå®ç°äº†å°ç¨‹åºçš„è‡ªå®šä¹‰ç™»é™†ï¼Œå°†è‡ªå®šä¹‰ç™»é™†æ€tokenè¿”å›ç»™å°ç¨‹åºä½œä¸ºç™»é™†å‡­è¯ã€‚ç”¨æˆ·çš„ä¿¡æ¯ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç™»é™†æ€tokenç¼“å­˜åœ¨redisä¸­ã€‚æ¶‰åŠçš„æŠ€æœ¯æ ˆï¼š</p><ul><li>SpringBoot -&gt; åç«¯åŸºç¡€ç¯å¢ƒ</li><li>Shiro -&gt; å®‰å…¨æ¡†æ¶</li><li>JWT -&gt; åŠ å¯†token</li><li>MySQL -&gt; ä¸»åº“ï¼Œå­˜å‚¨ä¸šåŠ¡æ•°æ®</li><li>MyBatis-Plus -&gt; æ“ä½œæ•°æ®åº“</li><li>Redis -&gt; ç¼“å­˜tokenå’Œå…¶ä»–çƒ­ç‚¹æ•°æ®</li><li>Lombok -&gt; ç®€åŒ–å¼€å‘</li><li>FastJson -&gt; jsonæ¶ˆæ¯å¤„ç†</li><li>RestTemplate -&gt; ä¼˜é›…çš„å¤„ç†webè¯·æ±‚</li></ul><p>é¡¹ç›®GitHubåœ°å€ï¼š<a href="https://github.com/gongsir0630/shiro-jwt-demo">https://github.com/gongsir0630/shiro-jwt-demo</a></p><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><ul><li>åŸºäºWxJavaå¯¹æ¥å¾®ä¿¡å°ç¨‹åºï¼Œå®ç°ç”¨æˆ·ç™»å½•ã€æ¶ˆæ¯å¤„ç†</li><li>æ”¯æŒShiroæ³¨è§£ç¼–ç¨‹ï¼Œä¿æŒé«˜åº¦çš„çµæ´»æ€§</li><li>ä½¿ç”¨JWTè¿›è¡Œæ ¡éªŒï¼Œå®Œå…¨å®ç°æ— çŠ¶æ€é‰´æƒ</li><li>ä½¿ç”¨Rediså­˜å‚¨è‡ªå®šä¹‰ç™»é™†æ€tokenï¼Œæ”¯æŒè¿‡æœŸæ—¶é—´</li><li>æ”¯æŒè·¨åŸŸè¯·æ±‚</li></ul><h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p><strong>åŸºç¡€çŸ¥è¯†é¢„å¤‡ï¼š</strong></p><ul><li>å…·å¤‡SpringBootåŸºç¡€çŸ¥è¯†å¹¶ä¸”ä¼šä½¿ç”¨åŸºæœ¬æ³¨è§£ï¼›</li><li>äº†è§£JWTï¼ˆJson Web Tokenï¼‰çš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶ä¸”ä¼šç®€å•æ“ä½œJWTçš„ <a href="https://github.com/auth0/java-jwt">JAVA SDK</a>ï¼›</li><li>äº†è§£Shiroçš„åŸºæœ¬æ¦‚å¿µï¼šSubjectã€Realmã€SecurityManagerç­‰ï¼ˆå»ºè®®å»å®˜ç½‘å­¦ä¹ ä¸€ä¸‹ï¼‰</li></ul><p><strong>å…¶ä»–è¯´æ˜ï¼š</strong></p><p>æœ¬æ–‡åªå¯¹shiroå’Œjwtæ•´åˆè¿›è¡Œä»‹ç»è¯´æ˜ï¼Œå…·ä½“çš„å¾®ä¿¡ç™»å½•å®ç°æ˜¯ä½¿ç”¨<code>RestTemplate</code>è°ƒç”¨æˆ‘è‡ªå·±çš„<code>wx-java-miniapp</code>é¡¹ç›®ï¼Œè¯¥é¡¹ç›®åŸºäº<code>WxJava</code>å®ç°ï¼Œæ”¯æŒå¤šä¸ªå°ç¨‹åºç™»å½•ã€æ¶ˆæ¯å¤„ç†ã€‚</p><p><strong>æœ¬æ–‡ä½¿ç”¨ä»¥ä¸‹è°ƒç”¨å¤„ç†å³å¯ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. todo: å¾®ä¿¡ç™»å½•: code + appid -&gt; openId + session_key</span></span><br><span class="line"><span class="comment">// appid: ä»é…ç½®æ–‡ä»¶è¯»å–</span></span><br><span class="line">MultiValueMap&lt;String, Object&gt; request = <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// å‚æ•°å°è£…, å¾®ä¿¡ç™»å½•éœ€è¦ä»¥ä¸‹å‚æ•°</span></span><br><span class="line">request.add(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line"><span class="comment">// eg: http://localhost:8081/wx/user/&#123;appid&#125;/login</span></span><br><span class="line"><span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> url+<span class="string">&quot;/user/&quot;</span>+appid+<span class="string">&quot;/login&quot;</span>;</span><br><span class="line"><span class="comment">// è¯·æ±‚</span></span><br><span class="line"><span class="type">JSONObject</span> <span class="variable">dto</span> <span class="operator">=</span> restTemplate.postForObject(path, request, JSONObject.class);</span><br><span class="line">log.info(<span class="string">&quot;---&gt;&gt;&gt;æ¥è‡ª[&#123;&#125;]çš„è¿”å› = [&#123;&#125;]&quot;</span>,path,dto);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. todo: ä½¿ç”¨openIdå’Œsession_keyç”Ÿæˆè‡ªå®šä¹‰ç™»å½•çŠ¶æ€ -&gt; token</span></span><br></pre></td></tr></table></figure><p><strong>é¡¹ç›®åœ°å€ï¼š</strong></p><ul><li><a href="https://github.com/gongsir0630/wx-java-miniapp">wx-java-miniapp -&gt; å¯ä»¥ç›´æ¥éƒ¨ç½²ä½¿ç”¨</a></li><li><a href="https://github.com/Wechat-Group/WxJava">WxJava -&gt; å®˜æ–¹SDK</a></li></ul><h2 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h2><p>å…ˆäº†è§£ä¸€ä¸‹å°ç¨‹åºå®˜æ–¹ç™»å½•æµç¨‹ï¼Œ<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html">å®˜æ–¹è¯´æ˜æˆ³è¿™é‡Œ</a></p><p><img src= "/blog/img/loading.gif" data-src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c7b2c5fa55c46fbbd41976635b20807~tplv-k3u1fbpfcp-watermark.image" alt="å°ç¨‹åºç™»å½•æµç¨‹"></p><ol><li>å°ç¨‹åºè°ƒç”¨<code>wx.login()</code>å¾—åˆ°<code>code</code>ï¼Œå°†codeå‘é€åˆ°åå°ï¼Œåå°é€šè¿‡<code>wx-java-miniapp</code>è·å–åˆ°ç”¨æˆ·çš„<code>openId</code>å’Œ<code>session_key</code>ï¼›</li><li>åå°é€šè¿‡jwtå·¥å…·ç”Ÿæˆè‡ªå®šä¹‰ç”¨æˆ·çŠ¶æ€ä¿¡æ¯<code>token</code>ï¼Œå¹¶ä¸”åå°åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢<code>openId</code>åˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œæ ¹æ®æŸ¥è¯¢ç»“æœå°è£…ä¸åŒçš„æ¶ˆæ¯ï¼Œæœ€åè¿åŒ<code>token</code>ä¸€èµ·è¿”å›ç»™å°ç¨‹åºï¼›</li><li>ä¹‹åç”¨æˆ·è®¿é—®æ¯ä¸€ä¸ªéœ€è¦æƒé™çš„APIè¯·æ±‚å¿…é¡»åœ¨<code>header</code>ä¸­æ·»åŠ <code>Authorization</code>å­—æ®µï¼Œåå°ä¼šè¿›è¡Œ<code>token</code>çš„æ ¡éªŒï¼Œå¦‚æœæœ‰è¯¯ä¼šç›´æ¥è¿”å›<code>401</code>ã€‚</li></ol><h2 id="tokenåŠ å¯†è¯´æ˜"><a href="#tokenåŠ å¯†è¯´æ˜" class="headerlink" title="tokenåŠ å¯†è¯´æ˜"></a>tokenåŠ å¯†è¯´æ˜</h2><ul><li>ä½¿ç”¨<code>uuid</code>éšæœºç”Ÿæˆä¸€ä¸ªjwt-id</li><li>å°†ç”¨æˆ·çš„<code>openId</code>ã€<code>session_key</code>è¿åŒ<code>jwt-id</code>ä¸€èµ·ï¼Œä½¿ç”¨å°ç¨‹åºçš„<code>appid</code>è¿›è¡Œç­¾ååŠ å¯†å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæœ€ç»ˆç”Ÿæˆ<code>token</code></li><li>å°†<code>&quot;JWT-SESSION-&quot;+jwt-id</code>å’Œ<code>token</code>ä»¥key-valueçš„å½¢å¼å­˜å…¥<code>redis</code>ä¸­ï¼Œå¹¶è®¾ç½®ç›¸åŒçš„è¿‡æœŸæ—¶é—´</li></ul><h2 id="tokenæ ¡éªŒè¯´æ˜"><a href="#tokenæ ¡éªŒè¯´æ˜" class="headerlink" title="tokenæ ¡éªŒè¯´æ˜"></a>tokenæ ¡éªŒè¯´æ˜</h2><ul><li>è§£ætokenä¸­jwt-id</li><li>ä»¥<code>&quot;JWT-SESSION-&quot;+jwt-id</code>ä¸ºkeyä»redisä¸­è·å–redisToken</li><li>è§£æ<code>redisToken</code>çš„æºå¸¦ä¿¡æ¯ï¼Œé‡æ–°ä»¥ç›¸åŒçš„æ–¹å¼ç”ŸæˆéªŒè¯å™¨ï¼ŒåŒ<code>token</code>è¿›è¡Œæ ¡éªŒæ¯”å¯¹</li></ul><h2 id="é¡¹ç›®å®ç°"><a href="#é¡¹ç›®å®ç°" class="headerlink" title="é¡¹ç›®å®ç°"></a>é¡¹ç›®å®ç°</h2><ul><li>é¡¹ç›®æ•°æ®åº“ä½¿ç”¨<code>MySQL</code>ä½œä¸ºä½œä¸ºä¸»åº“ï¼Œå¦‚æœæ˜¯<code>clone</code>çš„é¡¹ç›®ï¼Œè¯·åœ¨è¿è¡Œä¹‹å‰å‡†å¤‡å¥½ç›¸åº”çš„æ•°æ®åº“ï¼Œå¹¶ä¿®æ”¹é…ç½®ä¿¡æ¯ã€‚</li><li>é¡¹ç›®ä½¿ç”¨äº†redisç¼“å­˜ï¼Œè¿è¡Œå‰è¯·åœ¨æœ¬åœ°å®‰è£…<code>redis</code>ï¼Œä½¿ç”¨é»˜è®¤é…ç½®å³å¯ï¼Œæ— éœ€ä¿®æ”¹ã€‚</li><li>é¡¹ç›®ä¸­ä½¿ç”¨äº†<code>lombok</code>ç®€åŒ–å¼€å‘ï¼Œè¯·åœ¨ideaæˆ–è€…eclipseå®‰è£…lombokæ’ä»¶ã€‚</li></ul><h3 id="åˆ›å»ºMavené¡¹ç›®"><a href="#åˆ›å»ºMavené¡¹ç›®" class="headerlink" title="åˆ›å»ºMavené¡¹ç›®"></a>åˆ›å»ºMavené¡¹ç›®</h3><p>æ–°å»ºä¸€ä¸ªSpringBooté¡¹ç›®ï¼Œä¿®æ”¹pomæ–‡ä»¶ï¼Œæ·»åŠ ç›¸å…³dependency:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.gongsir0630<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-jwt-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>shiro-jwt-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.reporting.outputEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring-boot.version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">spring-boot.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- shiro: ç”¨æˆ·è®¤è¯\æ¥å£é‰´æƒ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- jwt: tokenè®¤è¯ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.auth0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>java-jwt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- redis: æ•°æ®ç¼“å­˜ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å¼•å…¥fastjson --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-json<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- druidæ•°æ®åº“è¿æ¥æ±  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis-plus: æ“ä½œæ•°æ®åº“ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mysqlé©±åŠ¨--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å·¥å…·: ç®€åŒ–modelå¼€å‘ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- å•å…ƒæµ‹è¯•å·¥å…· --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.github.gongsir0630.shirodemo.ShiroJwtDemoApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„JDKç‰ˆæœ¬ï¼š1.8</p></blockquote><h3 id="ç›¸å…³é…ç½®-å·¥å…·å‡†å¤‡"><a href="#ç›¸å…³é…ç½®-å·¥å…·å‡†å¤‡" class="headerlink" title="ç›¸å…³é…ç½® | å·¥å…·å‡†å¤‡"></a>ç›¸å…³é…ç½® | å·¥å…·å‡†å¤‡</h3><p>é…ç½®ä½ çš„application.yml ï¼Œä¸»è¦æ˜¯é…ç½®ä½ çš„å°ç¨‹åºappidå’Œurlï¼Œè¿˜æœ‰ä½ çš„æ•°æ®åº“å’Œredisã€‚</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è®¾ç½®æ—¥å¿—çº§åˆ«</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">    <span class="attr">level:</span></span><br><span class="line">        <span class="attr">org.springframework.web:</span> <span class="string">info</span></span><br><span class="line">        <span class="attr">com.github.gongsir0630.shirodemo:</span> <span class="string">debug</span></span><br><span class="line"><span class="comment"># devç¯å¢ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="comment"># æ•°æ®åº“ç›¸å…³é…ç½®ä¿¡æ¯: æ— éœ€å†æœ¬åœ°å®‰è£…mysql,ä½¿ç”¨yzhelp.topäº‘ç«¯æ•°æ®åº“</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/shiro-jwt-demo</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">password</span></span><br><span class="line">    <span class="comment"># redis é…ç½®ä¿¡æ¯: åœ¨æœ¬åœ°å®‰è£…redis</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">        <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># æœåŠ¡å¯åŠ¨çš„ç«¯å£å·</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># å¾®ä¿¡å°ç¨‹åºé…ç½® appid / url</span></span><br><span class="line"><span class="attr">wx:</span></span><br><span class="line">    <span class="comment"># å°ç¨‹åºAppId</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">appid</span></span><br><span class="line">    <span class="comment"># è‡ªç ”å°ç¨‹åºæ¥å£è°ƒç”¨åœ°å€</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://localhost:8081/wx</span></span><br></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼š<br/>appid: å½“å‰å°ç¨‹åºçš„appid<br/>url: wx-java-miniappé¡¹ç›®æ¥å£åœ°å€</p></blockquote><h4 id="é…ç½®fastJson"><a href="#é…ç½®fastJson" class="headerlink" title="é…ç½®fastJson"></a>é…ç½®fastJson</h4><p>åœ¨å¯åŠ¨ç±»ä¸­é…ç½®<code>fastJson</code> -&gt; <strong>ShiroJwtDemoApplication.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> gongsir &lt;a href=&quot;https://github.com/gongsir0630&quot;&gt;ç¨‹åºå‘˜Kyleâœ¨&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * æè¿°: Spring Boot å·¥ç¨‹å¯åŠ¨ç±»,å¯ä»¥ç›´æ¥ç‚¹å‡»ä¸‹é¢çš„mainæ–¹æ³•è¿è¡Œç¨‹åº</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroJwtDemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(ShiroJwtDemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * fastjson é…ç½®æ³¨å…¥: ä½¿ç”¨é˜¿é‡Œå·´å·´çš„ fastjson å¤„ç† json ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> HttpMessageConverters</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HttpMessageConverters <span class="title function_">fastJsonHttpMessageConverters</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ¶ˆæ¯è½¬æ¢å¯¹è±¡</span></span><br><span class="line">        <span class="type">FastJsonHttpMessageConverter</span> <span class="variable">converter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastJsonHttpMessageConverter</span>();</span><br><span class="line">        <span class="comment">// fastjson é…ç½®</span></span><br><span class="line">        <span class="type">FastJsonConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FastJsonConfig</span>();</span><br><span class="line">        config.setSerializerFeatures(SerializerFeature.PrettyFormat);</span><br><span class="line">        config.setDateFormat(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="comment">// é…ç½®æ³¨å…¥æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line">        converter.setFastJsonConfig(config);</span><br><span class="line">        <span class="comment">// è®© spring ä½¿ç”¨è‡ªå®šä¹‰çš„æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HttpMessageConverters</span>(converter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="é…ç½®Redis"><a href="#é…ç½®Redis" class="headerlink" title="é…ç½®Redis"></a>é…ç½®Redis</h4><p>é…ç½®Redis -&gt; <strong>RedisConfig.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/20 14:15</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: Redisé…ç½®</span></span><br><span class="line"><span class="comment"> * EnableCaching: å¼€å¯ç¼“å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CacheManager <span class="title function_">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> RedisCacheManager.create(factory);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="é…ç½®RestTemplate"><a href="#é…ç½®RestTemplate" class="headerlink" title="é…ç½®RestTemplate"></a>é…ç½®RestTemplate</h4><p>é…ç½®RestTemplate -&gt; <strong>RestTemplateConfig.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/20 14:10</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: RestTemplateçš„é…ç½®ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">(ClientHttpRequestFactory factory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ClientHttpRequestFactory <span class="title function_">simpleClientHttpRequestFactory</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">SimpleClientHttpRequestFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleClientHttpRequestFactory</span>();</span><br><span class="line">        <span class="comment">// è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º10ç§’</span></span><br><span class="line">        factory.setConnectTimeout(<span class="number">1000</span> * <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// è¯»å–è¶…æ—¶æ—¶é—´ä¸ºå•ä½ä¸º60ç§’</span></span><br><span class="line">        factory.setReadTimeout(<span class="number">1000</span> * <span class="number">60</span>);</span><br><span class="line">        <span class="keyword">return</span> factory;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è¿”å›é›†å°è£…"><a href="#è¿”å›é›†å°è£…" class="headerlink" title="è¿”å›é›†å°è£…"></a>è¿”å›é›†å°è£…</h4><p><strong>CodeMsg.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/22 20:17</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: codeå’Œmsgå°è£…</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeMsg</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CodeMsg SUCCESS=<span class="keyword">new</span> <span class="title class_">CodeMsg</span>(<span class="number">0</span>,<span class="string">&quot;success&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">CodeMsg</span> <span class="variable">LOGIN_FAIL</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CodeMsg</span>(-<span class="number">1</span>,<span class="string">&quot;code2session failure, please try aging&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">CodeMsg</span> <span class="variable">NO_USER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CodeMsg</span>(<span class="number">1000</span>,<span class="string">&quot;user not found&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">CodeMsg</span> <span class="variable">SESSION_KEY_ERROR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CodeMsg</span>(<span class="number">1001</span>,<span class="string">&quot;sessionKey is invalid&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">CodeMsg</span> <span class="variable">TOKEN_ERROR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CodeMsg</span>(<span class="number">1002</span>,<span class="string">&quot;token is invalid&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">CodeMsg</span> <span class="variable">SHIRO_ERROR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CodeMsg</span>(<span class="number">1003</span>,<span class="string">&quot;token is invalid&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CodeMsg</span><span class="params">(<span class="type">int</span> code, String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code=code;</span><br><span class="line">        <span class="built_in">this</span>.msg=msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;CodeMsg&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;code=&quot;</span> + code +</span><br><span class="line">                <span class="string">&quot;, msg=&#x27;&quot;</span> + msg + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Result.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/20 18:45</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°:</span></span><br><span class="line"><span class="comment"> * è¾“å‡ºç»“æœçš„å°è£…</span></span><br><span class="line"><span class="comment"> * åªè¦getä¸è¦set,è¿›è¡Œæ›´å¥½çš„å°è£…</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; dataæ³›å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Result</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.code=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.msg=<span class="string">&quot;success&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.data=data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Result</span><span class="params">(CodeMsg mg, T data)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (mg==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.code=mg.getCode();</span><br><span class="line">        <span class="built_in">this</span>.msg=mg.getMsg();</span><br><span class="line">        <span class="built_in">this</span>.data=data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æˆåŠŸæ—¶</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; dataæ³›å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;  Result&lt;T&gt;  <span class="title function_">success</span><span class="params">(T data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤±è´¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; dataæ³›å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt;  Result&lt;T&gt;  <span class="title function_">fail</span><span class="params">(CodeMsg mg, T data)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;(mg,data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="å¼‚å¸¸å°è£…ä¸å¤„ç†"><a href="#å¼‚å¸¸å°è£…ä¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å°è£…ä¸å¤„ç†"></a>å¼‚å¸¸å°è£…ä¸å¤„ç†</h4><p>è‡ªå®šä¹‰å¼‚å¸¸ -&gt; <strong>ApiAuthException.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.controller.res.CodeMsg;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/22 20:24</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: è‡ªå®šä¹‰å¼‚å¸¸, ç”¨äºå¤„ç†Apiè®¤è¯å¤±è´¥å¼‚å¸¸ä¿¡æ¯ä¿å­˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiAuthException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CodeMsg codeMsg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiAuthException</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ApiAuthException</span><span class="params">(CodeMsg codeMsg)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(codeMsg.getMsg());</span><br><span class="line">        <span class="built_in">this</span>.codeMsg = codeMsg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CodeMsg <span class="title function_">getCodeMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> codeMsg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCodeMsg</span><span class="params">(CodeMsg codeMsg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.codeMsg = codeMsg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¨å±€å¼‚å¸¸å¤„ç† -&gt; <strong>AppExceptionHandler.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/20 15:49</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: å…¨å±€å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç† Shiro å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> json</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123;ShiroException.class&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.UNAUTHORIZED)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Result&lt;JSONObject&gt;&gt; <span class="title function_">handShiroException</span><span class="params">(ShiroException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;---&gt;&gt;&gt; æ•æ‰åˆ° [ApiAuthException] å¼‚å¸¸: &#123;&#125;&quot;</span>, e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(Result.fail(CodeMsg.SHIRO_ERROR,<span class="literal">null</span>), HttpStatus.UNAUTHORIZED);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¤„ç† è‡ªå®šä¹‰ApiAuthExceptionå¼‚å¸¸</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e å¼‚å¸¸ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> json</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(&#123;ApiAuthException.class&#125;)</span></span><br><span class="line">    <span class="meta">@ResponseStatus(HttpStatus.UNAUTHORIZED)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Result&lt;JSONObject&gt;&gt; <span class="title function_">handApiAuthException</span><span class="params">(ApiAuthException e)</span> &#123;</span><br><span class="line">        log.error(<span class="string">&quot;---&gt;&gt;&gt; æ•æ‰åˆ° [ApiAuthException] å¼‚å¸¸: &#123;&#125;,&#123;&#125;&quot;</span>,e.getCodeMsg().getCode(),e.getCodeMsg().getMsg() );</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(Result.fail(e.getCodeMsg(),<span class="literal">null</span>), HttpStatus.UNAUTHORIZED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‡†å¤‡æ•°æ®æº"><a href="#å‡†å¤‡æ•°æ®æº" class="headerlink" title="å‡†å¤‡æ•°æ®æº"></a>å‡†å¤‡æ•°æ®æº</h3><ul><li>æ•°æ®åº“ï¼šshiro-jwt-demo</li><li>æ•°æ®è¡¨ï¼šuser<br><img src= "/blog/img/loading.gif" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b52785aad974131a859d2a51feaa0ca~tplv-k3u1fbpfcp-watermark.image" alt="ç¤ºä¾‹æ•°æ®åº“è¡¨ç»“æ„"></li></ul><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œæ˜¯ä¸šåŠ¡æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å°ç¨‹åºç”¨æˆ·ä¿¡æ¯éƒ½ç”±æˆ‘ä»¬è‡ªå·±å­˜å‚¨ï¼Œç¬¬ä¸€æ¬¡é»˜è®¤ä½¿ç”¨å¾®ä¿¡å…¬å¼€ä¿¡æ¯æ³¨å†Œï¼Œä¹‹åç”¨æˆ·å¯ä»¥è‡ªè¡Œæ›´æ–°è¿™äº›ä¿¡æ¯ï¼Œå’Œå¾®ä¿¡ä¿¡æ¯ç‹¬ç«‹å¼€ã€‚</p></blockquote><p>åˆ›å»ºå¯¹åº”çš„å®ä½“ç±» -&gt; <strong>User.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/21 23:44</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: ä¸šåŠ¡ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸»é”®,æ•°æ®åº“å­—æ®µä¸ºuser_id -&gt; userId == openId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@TableId(value = &quot;user_id&quot;,type = IdType.INPUT)</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String photo;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">    <span class="keyword">private</span> String grade;</span><br><span class="line">    <span class="keyword">private</span> String college;</span><br><span class="line">    <span class="keyword">private</span> String contact;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨MyBatis-plusåˆ›å»ºmapperæ¥å£ -&gt; <strong>UserMapper.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/22 19:44</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: Userç±»mapperæ¥å£,ç»§æ‰¿è‡ªBaseMapper(å·²ç»å®ç°Userçš„CRUD)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MyBatis-Plusé…ç½® -&gt; <strong>MybatisPlusConfig.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/19 17:15</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: MyBatis-Plusæ’ä»¶é…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.github.gongsir0630.shirodemo.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºUserä¸šåŠ¡æ¥å£ï¼Œè¿™é‡Œä»…ä»…æ¼”ç¤ºlogin -&gt; <strong>UserService.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/22 19:49</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: ç”¨æˆ·æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç™»å½•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> jsCode å°ç¨‹åºcode</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç™»å½•ä¿¡æ¯: åŒ…å«token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Map&lt;String, String&gt; <span class="title function_">login</span><span class="params">(String jsCode)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†åˆ›å»ºä¸€ä¸ªå¾®ä¿¡ç™»å½•ä¿¡æ¯å¯¹è±¡ï¼Œä¸»è¦ç”¨ä½œæ¥æ”¶å¾®ä¿¡çš„openidå’Œsession_keyï¼Œä»¥åŠç”¨ä½œshiroè®¤è¯ -&gt; <strong>WxAccount.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> * <span class="meta">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https:<span class="comment">//github.com/gongsir0630</span></span><br><span class="line"> * <span class="meta">@date</span> <span class="number">2021</span>/<span class="number">3</span>/<span class="number">22</span> <span class="number">19</span>:<span class="number">58</span></span><br><span class="line"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span><br><span class="line"> * æè¿°: å¾®ä¿¡è®¤è¯ä¿¡æ¯</span><br><span class="line"> */</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxAccount</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String openId;</span><br><span class="line">    <span class="keyword">private</span> String sessionKey;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨æ„ï¼šè¯¥ç±»ä¸ä¼šç”¨äºä¸šåŠ¡ä¿¡æ¯äº¤äº’ï¼Œæ‰€ä»¥ä¸éœ€è¦Mapperä¸dbäº¤äº’ã€‚</p></blockquote><p>å¾®ä¿¡ç™»å½•æ¥å£ï¼Œåœ¨è¿™é‡Œå®ç°ä¸å¾®ä¿¡æœåŠ¡å™¨çš„ä¿¡æ¯äº¤äº’ -&gt; <strong>WxAccountService.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> * <span class="meta">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https:<span class="comment">//github.com/gongsir0630</span></span><br><span class="line"> * <span class="meta">@date</span> <span class="number">2021</span>/<span class="number">3</span>/<span class="number">22</span> <span class="number">20</span>:<span class="number">06</span></span><br><span class="line"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span><br><span class="line"> * æè¿°: å¾®ä¿¡æ¥å£</span><br><span class="line"> */</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WxAccountService</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¾®ä¿¡å°ç¨‹åºç”¨æˆ·ç™»é™†ï¼Œå®Œæ•´æµç¨‹å¯å‚è€ƒä¸‹é¢å®˜æ–¹åœ°å€ï¼Œæœ¬ä¾‹ä¸­æ˜¯æŒ‰æ­¤æµç¨‹å¼€å‘</span></span><br><span class="line"><span class="comment">     * https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html</span></span><br><span class="line"><span class="comment">     * 1 . å¾®ä¿¡å°ç¨‹åºç«¯ä¼ å…¥codeã€‚</span></span><br><span class="line"><span class="comment">     * 2 . é€šè¿‡wx-java-miniappé¡¹ç›®è°ƒç”¨å¾®ä¿¡code2sessionæ¥å£è·å–openidå’Œsession_key</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code å°ç¨‹åºç«¯ è°ƒç”¨ wx.login è·å–åˆ°çš„code,ç”¨äºè°ƒç”¨ å¾®ä¿¡code2sessionæ¥å£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> JSONObject: åŒ…å«openIdå’ŒsessionKey</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    WxAccount <span class="title function_">login</span><span class="params">(String code)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥å£å®ç°é€»è¾‘ï¼š</p><ol><li>ä»é…ç½®æ–‡ä»¶è¯»å–<code>appid</code>å’Œ<code>url</code>ï¼›</li><li>å‡­å€Ÿç›®æ ‡è¯·æ±‚åœ°å€<code>path</code>ï¼Œä¾‹å¦‚ç™»å½•æ˜¯ <code>&#123;url&#125;/wx/user/&#123;appid&#125;/login</code>ï¼›</li><li>å‚æ•°å°è£…ï¼Œå°è£…æ¥è‡ªå°ç¨‹åºçš„<code>code</code>ï¼›</li><li>ä½¿ç”¨<code>RestTemplate</code>å‘èµ·ç™»å½•è¯·æ±‚ï¼›</li><li>å¤„ç†è¿”å›é›†ã€‚</li></ol><p>ä»£ç å®ç° -&gt; <strong>WxAccountServiceImpl.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/20 16:12</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: å¾®ä¿¡æ¥å£å®ç°: ç”¨ restTemplate è°ƒç”¨ [wxApp] åº”ç”¨çš„æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxAccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">WxAccountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.appid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appid;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.url&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> WxAccount <span class="title function_">login</span><span class="params">(String code)</span> &#123;</span><br><span class="line">        <span class="comment">// todo: å¾®ä¿¡ç™»å½•: code + appid -&gt; openId + session_key</span></span><br><span class="line">        <span class="comment">// appid: ä»é…ç½®æ–‡ä»¶è¯»å–</span></span><br><span class="line">        MultiValueMap&lt;String, Object&gt; request = <span class="keyword">new</span> <span class="title class_">LinkedMultiValueMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// å‚æ•°å°è£…, å¾®ä¿¡ç™»å½•éœ€è¦ä»¥ä¸‹å‚æ•°</span></span><br><span class="line">        request.add(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        <span class="comment">// eg: http://localhost:8081/wx/user/&#123;appid&#125;/login</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> url+<span class="string">&quot;/user/&quot;</span>+appid+<span class="string">&quot;/login&quot;</span>;</span><br><span class="line">        <span class="comment">// è¯·æ±‚</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">dto</span> <span class="operator">=</span> restTemplate.postForObject(path, request, JSONObject.class);</span><br><span class="line">        log.info(<span class="string">&quot;---&gt;&gt;&gt;æ¥è‡ª[&#123;&#125;]çš„è¿”å› = [&#123;&#125;]&quot;</span>,path,dto);</span><br><span class="line">        <span class="type">int</span> <span class="variable">errCode</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (dto != <span class="literal">null</span> ) &#123;</span><br><span class="line">            errCode = Integer.parseInt(dto.get(<span class="string">&quot;code&quot;</span>).toString());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApiAuthException</span>(CodeMsg.LOGIN_FAIL);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> != errCode) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApiAuthException</span>(<span class="keyword">new</span> <span class="title class_">CodeMsg</span>(Integer.parseInt(dto.get(<span class="string">&quot;code&quot;</span>).toString()),</span><br><span class="line">                dto.get(<span class="string">&quot;msg&quot;</span>).toString()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// code2session success</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">data</span> <span class="operator">=</span> dto.getJSONObject(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> JSON.toJavaObject(data, WxAccount.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„å»ºJWT"><a href="#æ„å»ºJWT" class="headerlink" title="æ„å»ºJWT"></a>æ„å»ºJWT</h3><p>jwtå·¥å…·ç±»ï¼Œç”¨äºç”Ÿæˆtokenç­¾å, tokenæ ¡éªŒ -&gt; <strong>JwtUtil.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/23 10:26</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: jwtå·¥å…·ç±»: ç”Ÿæˆtokenç­¾å, tokenæ ¡éªŒ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;All&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿‡æœŸæ—¶é—´: 2å°æ—¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">EXPIRE_TIME</span> <span class="operator">=</span> <span class="number">7200</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ appid ç­¾å</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;wx.appid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appsecret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®å¾®ä¿¡ç”¨æˆ·ç™»é™†ä¿¡æ¯åˆ›å»º token</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨`uuid`éšæœºç”Ÿæˆä¸€ä¸ªjwt-id</span></span><br><span class="line"><span class="comment">     * å°†ç”¨æˆ·çš„`openId`ã€`session_key`è¿åŒ`jwt-id`ä¸€èµ·ï¼Œä½¿ç”¨å°ç¨‹åºçš„`appid`è¿›è¡Œç­¾ååŠ å¯†å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæœ€ç»ˆç”Ÿæˆ`token`</span></span><br><span class="line"><span class="comment">     * å°†`&quot;JWT-SESSION-&quot;+jwt-id`å’Œ`token`ä»¥key-valueçš„å½¢å¼å­˜å…¥`redis`ä¸­ï¼Œå¹¶è®¾ç½®ç›¸åŒçš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="comment">     * æ³¨ : è¿™é‡Œçš„tokenä¼šè¢«ç¼“å­˜åˆ°redisä¸­,ç”¨ä½œä¸ºäºŒæ¬¡éªŒè¯</span></span><br><span class="line"><span class="comment">     * redisé‡Œé¢ç¼“å­˜çš„æ—¶é—´åº”è¯¥å’Œjwt tokençš„è¿‡æœŸæ—¶é—´è®¾ç½®ç›¸åŒ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wxAccount å¾®ä¿¡ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å› jwt token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sign</span><span class="params">(WxAccount account)</span> &#123;</span><br><span class="line">        <span class="comment">//JWT éšæœºID,åšä¸ºrediséªŒè¯çš„key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwtId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        <span class="comment">//1 . åŠ å¯†ç®—æ³•è¿›è¡Œç­¾åå¾—åˆ°token</span></span><br><span class="line">        <span class="type">Algorithm</span> <span class="variable">algorithm</span> <span class="operator">=</span> Algorithm.HMAC256(appsecret);</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JWT.create()</span><br><span class="line">                .withClaim(<span class="string">&quot;openId&quot;</span>, account.getOpenId())</span><br><span class="line">                .withClaim(<span class="string">&quot;sessionKey&quot;</span>, account.getSessionKey())</span><br><span class="line">                .withClaim(<span class="string">&quot;jwt-id&quot;</span>,jwtId)</span><br><span class="line">                .withExpiresAt(<span class="keyword">new</span> <span class="title class_">Date</span>(System.currentTimeMillis() + EXPIRE_TIME * <span class="number">1000</span>))</span><br><span class="line">                .sign(algorithm);</span><br><span class="line">        <span class="comment">//2 . Redisç¼“å­˜JWT, æ³¨ : è¯·å’ŒJWTè¿‡æœŸæ—¶é—´ä¸€è‡´</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;JWT-SESSION-&quot;</span>+jwtId, token, EXPIRE_TIME, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * token æ£€éªŒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">verify</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1 . æ ¹æ®tokenè§£å¯†ï¼Œè§£å¯†å‡ºjwt-id , å…ˆä»redisä¸­æŸ¥æ‰¾å‡ºredisTokenï¼ŒåŒ¹é…æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">redisToken</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;JWT-SESSION-&quot;</span> + getClaimsByToken(token).get(<span class="string">&quot;jwt-id&quot;</span>).asString());</span><br><span class="line">            <span class="keyword">if</span> (!token.equals(redisToken)) &#123;</span><br><span class="line">                <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//2 . å¾—åˆ°ç®—æ³•ç›¸åŒçš„JWTVerifier</span></span><br><span class="line">            <span class="type">Algorithm</span> <span class="variable">algorithm</span> <span class="operator">=</span> Algorithm.HMAC256(appsecret);</span><br><span class="line">            <span class="type">JWTVerifier</span> <span class="variable">verifier</span> <span class="operator">=</span> JWT.require(algorithm)</span><br><span class="line">                    .withClaim(<span class="string">&quot;openId&quot;</span>, getClaimsByToken(redisToken).get(<span class="string">&quot;openId&quot;</span>).asString())</span><br><span class="line">                    .withClaim(<span class="string">&quot;sessionKey&quot;</span>, getClaimsByToken(redisToken).get(<span class="string">&quot;sessionKey&quot;</span>).asString())</span><br><span class="line">                    .withClaim(<span class="string">&quot;jwt-id&quot;</span>,getClaimsByToken(redisToken).get(<span class="string">&quot;jwt-id&quot;</span>).asString())</span><br><span class="line">                    .build();</span><br><span class="line">            <span class="comment">//3 . éªŒè¯token</span></span><br><span class="line">            verifier.verify(token);</span><br><span class="line">            <span class="comment">//4 . Redisç¼“å­˜JWTç»­æœŸ</span></span><br><span class="line">            redisTemplate.opsForValue().set(<span class="string">&quot;JWT-SESSION-&quot;</span> + getClaimsByToken(token).get(<span class="string">&quot;jwt-id&quot;</span>).asString(),</span><br><span class="line">                    redisToken,</span><br><span class="line">                    EXPIRE_TIME,</span><br><span class="line">                    TimeUnit.SECONDS);</span><br><span class="line">            <span class="keyword">return</span> Boolean.TRUE;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//æ•æ‰åˆ°ä»»ä½•å¼‚å¸¸éƒ½è§†ä¸ºæ ¡éªŒå¤±è´¥</span></span><br><span class="line">            <span class="keyword">return</span> Boolean.FALSE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»tokenè§£å¯†ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> token token</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> JWTDecodeException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Claim&gt; <span class="title function_">getClaimsByToken</span><span class="params">(String token)</span> <span class="keyword">throws</span> JWTDecodeException &#123;</span><br><span class="line">        <span class="keyword">return</span> JWT.decode(token).getClaims();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Realmé…ç½®"><a href="#Realmé…ç½®" class="headerlink" title="Realmé…ç½®"></a>Realmé…ç½®</h3><p>åˆ›å»ºJwtTokenï¼Œç”¨äºshiroé‰´æƒï¼Œéœ€è¦å®ç°<code>AuthenticationToken</code> -&gt; <strong>JwtToken.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/23 10:48</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: é‰´æƒç”¨çš„tokenï¼Œéœ€è¦å®ç° AuthenticationToken</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtToken</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationToken</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getPrincipal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getCredentials</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è‡ªå®šä¹‰Shiroçš„Realmé…ç½®ï¼Œéœ€è¦åœ¨Realmä¸­å®ç°æˆ‘ä»¬è‡ªå®šä¹‰çš„ç™»é™†åŠæˆæƒé€»è¾‘ -&gt; <strong>ShiroRealm.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.controller.res.CodeMsg;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.exception.ApiAuthException;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.wx.util.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.wx.vo.JwtToken;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationException;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.AuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.SimpleAuthenticationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authc.credential.CredentialsMatcher;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.realm.Realm;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/23 15:28</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: Realm çš„ä¸€ä¸ªé…ç½®ç®¡ç†ç±» allRealm()æ–¹æ³•å¾—åˆ°æ‰€æœ‰çš„realm</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroRealm</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JwtUtil jwtUtil;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°è£…æ‰€æœ‰è‡ªå®šä¹‰çš„realmè§„åˆ™é“¾ -&gt; shiroé…ç½®ä¸­ä¼šå°†è§„åˆ™æ³¨å…¥åˆ°shiroçš„securityManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰€æœ‰è‡ªå®šä¹‰çš„realmè§„åˆ™</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Realm&gt; <span class="title function_">allRealm</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Realm&gt; realmList = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        realmList.add(authorizingRealm());</span><br><span class="line">        <span class="keyword">return</span> Collections.unmodifiableList(realmList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è‡ªå®šä¹‰ JWTçš„ Realm</span></span><br><span class="line"><span class="comment">     * é‡å†™ Realm çš„ supports() æ–¹æ³•æ˜¯é€šè¿‡ JWT è¿›è¡Œç™»å½•åˆ¤æ–­çš„å…³é”®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> AuthorizingRealm <span class="title function_">authorizingRealm</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">AuthorizingRealm</span> <span class="variable">realm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthorizingRealm</span>() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * å½“éœ€è¦æ£€æµ‹ ç”¨æˆ·æƒé™ æ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œä¾‹å¦‚checkRole,checkPermissionä¹‹ç±»çš„</span></span><br><span class="line"><span class="comment">             * æ ¹æ®ä¸šåŠ¡éœ€æ±‚è‡ªè¡Œç¼–å†™éªŒè¯é€»è¾‘</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> principalCollection == token</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> principalCollection.toString();</span><br><span class="line">                log.info(<span class="string">&quot;---&gt;&gt;&gt;PrincipalCollection: [&#123;&#125;]&quot;</span>,token);</span><br><span class="line">                <span class="comment">// todo: è‡ªå®šä¹‰æƒé™éªŒè¯, æ¯”å¦‚roleå’ŒpermissionéªŒè¯</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthorizationInfo</span>();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * é»˜è®¤ä½¿ç”¨æ­¤æ–¹æ³•è¿›è¡Œç”¨æˆ·åæ­£ç¡®ä¸å¦æ ¡éªŒ: éªŒè¯tokené€»è¾‘</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">jwtToken</span> <span class="operator">=</span> (String) authenticationToken.getCredentials();</span><br><span class="line">                <span class="type">String</span> <span class="variable">openId</span> <span class="operator">=</span> jwtUtil.getClaimsByToken(jwtToken).get(<span class="string">&quot;openId&quot;</span>).asString();</span><br><span class="line">                <span class="type">String</span> <span class="variable">sessionKey</span> <span class="operator">=</span> jwtUtil.getClaimsByToken(jwtToken).get(<span class="string">&quot;sessionKey&quot;</span>).asString();</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == openId || <span class="string">&quot;&quot;</span>.equals(openId)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApiAuthException</span>(CodeMsg.NO_USER);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == sessionKey || <span class="string">&quot;&quot;</span>.equals(sessionKey)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApiAuthException</span>(CodeMsg.SESSION_KEY_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (!jwtUtil.verify(jwtToken)) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ApiAuthException</span>(CodeMsg.TOKEN_ERROR);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å°† openId å’Œ sessionKey è£…é…åˆ°subjectä¸­</span></span><br><span class="line">                <span class="comment">// åœ¨ Controller ä¸­ä½¿ç”¨ SecurityUtils.getSubject().getPrincipal() å³å¯è·å–ç”¨æˆ·openId</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(openId,sessionKey,<span class="built_in">this</span>.getClass().getName());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * æ³¨æ„å‘ç‚¹ : å¿…é¡»é‡å†™æ­¤æ–¹æ³•ï¼Œä¸ç„¶Shiroä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">             * å› ä¸ºåˆ›å»ºäº† JWTToken ç”¨äºæ›¿æ¢ShiroåŸç”Ÿ token,æ‰€ä»¥å¿…é¡»åœ¨æ­¤æ–¹æ³•ä¸­æ˜¾å¼çš„è¿›è¡Œæ›¿æ¢ï¼Œå¦åˆ™åœ¨è¿›è¡Œåˆ¤æ–­æ—¶ä¼šä¸€ç›´å¤±è´¥</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(AuthenticationToken token)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> token <span class="keyword">instanceof</span> JwtToken;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        realm.setCredentialsMatcher(credentialsMatcher());</span><br><span class="line">        <span class="keyword">return</span> realm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨æ„ : å¯†ç æ ¡éªŒ, è¿™é‡Œå› ä¸ºæ˜¯JWTå½¢å¼,å°±æ— éœ€å¯†ç æ ¡éªŒå’ŒåŠ å¯†,ç›´æ¥è®©å…¶è¿”å›ä¸ºtrue(å¦‚æœä¸è®¾ç½®çš„è¯,è¯¥å€¼é»˜è®¤ä¸ºfalse,å³å§‹ç»ˆéªŒè¯ä¸é€šè¿‡)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> CredentialsMatcher <span class="title function_">credentialsMatcher</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å®ç°boolean doCredentialsMatch(AuthenticationToken var1, AuthenticationInfo var2);</span></span><br><span class="line">        <span class="keyword">return</span> (authenticationToken, authenticationInfo) -&gt; <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å†™filter"><a href="#é‡å†™filter" class="headerlink" title="é‡å†™filter"></a>é‡å†™filter</h3><p>æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡<code>Filter</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§æ‰¿å®˜æ–¹çš„<code>BasicHttpAuthenticationFilter</code>ï¼Œå¹¶ä¸”é‡å†™æ–¹æ³•å³å¯ -&gt; <strong>JwtFilter.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.wx.vo.JwtToken;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.filter.authc.BasicHttpAuthenticationFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/23 10:58</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: JWTæ ¸å¿ƒè¿‡æ»¤å™¨é…ç½®</span></span><br><span class="line"><span class="comment"> * æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡Filterï¼Œç»§æ‰¿å®˜æ–¹çš„BasicHttpAuthenticationFilterï¼Œå¹¶ä¸”é‡å†™é‰´æƒçš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * æ‰§è¡Œæµç¨‹ preHandle-&gt;isAccessAllowed-&gt;isLoginAttempt-&gt;executeLogin</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtFilter</span> <span class="keyword">extends</span> <span class="title class_">BasicHttpAuthenticationFilter</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·¨åŸŸæ”¯æŒ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request è¯·æ±‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response ç›¸åº”</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception å¼‚å¸¸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">httpServletRequest</span> <span class="operator">=</span> (HttpServletRequest) request;</span><br><span class="line">        <span class="type">HttpServletResponse</span> <span class="variable">httpServletResponse</span> <span class="operator">=</span> (HttpServletResponse) response;</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">&quot;Access-control-Allow-Origin&quot;</span>, httpServletRequest.getHeader(<span class="string">&quot;Origin&quot;</span>));</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;GET,POST,OPTIONS,PUT,DELETE&quot;</span>);</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, httpServletRequest.getHeader(<span class="string">&quot;Access-Control-Request-Headers&quot;</span>));</span><br><span class="line">        <span class="comment">// è·¨åŸŸæ—¶ä¼šé¦–å…ˆå‘é€ä¸€ä¸ªoptionè¯·æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬ç»™optionè¯·æ±‚ç›´æ¥è¿”å›æ­£å¸¸çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class="line">            httpServletResponse.setStatus(HttpStatus.OK.value());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.preHandle(request, response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isLoginAttempt</span><span class="params">(ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­requestæ˜¯å¦åŒ…å« Authorization å­—æ®µ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">auth</span> <span class="operator">=</span> getAuthzHeader(request);</span><br><span class="line">        <span class="keyword">return</span> auth != <span class="literal">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(auth);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isAccessAllowed</span><span class="params">(ServletRequest request, ServletResponse response, Object mappedValue)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isLoginAttempt(request,response)) &#123;</span><br><span class="line">            <span class="comment">// executeLogin è¿›å…¥ç™»å½•é€»è¾‘</span></span><br><span class="line">            <span class="comment">// ä»requestè¯·æ±‚å¤´è·å– Authorization å­—æ®µ</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> getAuthzHeader(request);</span><br><span class="line">            log.info(<span class="string">&quot;---&gt;&gt;&gt;JwtFilter::isAccessAllowedæ‹¦æˆªåˆ°è®¤è¯tokenä¿¡æ¯:[&#123;&#125;]&quot;</span>,token);</span><br><span class="line">            <span class="comment">// è¿™é‡Œä¼šæäº¤ç»™åˆšåˆšæˆ‘ä»¬è‡ªå®šä¹‰çš„realmå¤„ç†</span></span><br><span class="line">            getSubject(request,response).login(<span class="keyword">new</span> <span class="title class_">JwtToken</span>(token));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿™é‡Œè¿”å›trueè¡¨ç¤ºæ‰€æœ‰éªŒè¯ç»“æœéƒ½èƒ½é€šè¿‡, åœ¨controllerä¸­å¯ä»¥ä½¿ç”¨shiroæ³¨è§£é™åˆ¶æ˜¯å¦éœ€è¦ç™»å½•æƒé™</span></span><br><span class="line">        <span class="comment">// è®¾ç½®trueå³å…è®¸æ¸¸å®¢è®¿é—®</span></span><br><span class="line">        <span class="comment">// è®¾ç½®falseåˆ™å¿…é¡»æºå¸¦tokenè¿›è¡ŒéªŒè¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Shiroæ ¸å¿ƒé…ç½®"><a href="#Shiroæ ¸å¿ƒé…ç½®" class="headerlink" title="Shiroæ ¸å¿ƒé…ç½®"></a>Shiroæ ¸å¿ƒé…ç½®</h3><p>æ ¸å¿ƒé…ç½® -&gt; <strong>ShiroConfig.java</strong></p><ul><li>é…ç½®realmè§„åˆ™é“¾</li><li>é…ç½®è®¿é—®ç­–ç•¥ï¼šurlå’Œfilter</li><li>å¼€å¯shiroæ³¨è§£æ”¯æŒ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.filter.JwtFilter;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSessionStorageEvaluator;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.mgt.DefaultSubjectDAO;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.LifecycleBeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.DependsOn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.Filter;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/20 16:48</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: shiroæ ¸å¿ƒé…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * SecurityManager,å®‰å…¨ç®¡ç†å™¨,æ‰€æœ‰ä¸å®‰å…¨ç›¸å…³çš„æ“ä½œéƒ½ä¼šä¸ä¹‹è¿›è¡Œäº¤äº’;</span></span><br><span class="line"><span class="comment">     * å®ƒç®¡ç†ç€æ‰€æœ‰Subject,æ‰€æœ‰Subjectéƒ½ç»‘å®šåˆ°SecurityManager,ä¸Subjectçš„æ‰€æœ‰äº¤äº’éƒ½ä¼šå§”æ‰˜ç»™SecurityManager</span></span><br><span class="line"><span class="comment">     * DefaultWebSecurityManager :</span></span><br><span class="line"><span class="comment">     * ä¼šåˆ›å»ºé»˜è®¤çš„DefaultSubjectDAO(å®ƒåˆä¼šé»˜è®¤åˆ›å»ºDefaultSessionStorageEvaluator)</span></span><br><span class="line"><span class="comment">     * ä¼šé»˜è®¤åˆ›å»ºDefaultWebSubjectFactory</span></span><br><span class="line"><span class="comment">     * ä¼šé»˜è®¤åˆ›å»ºModularRealmAuthenticator</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultWebSecurityManager <span class="title function_">securityManager</span><span class="params">(ShiroRealm shiroRealm)</span> &#123;</span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">        <span class="comment">// è®¾ç½®realms</span></span><br><span class="line">        securityManager.setRealms(shiroRealm.allRealm());</span><br><span class="line">        <span class="comment">// close session</span></span><br><span class="line">        <span class="type">DefaultSubjectDAO</span> <span class="variable">defaultSubjectDAO</span> <span class="operator">=</span> (DefaultSubjectDAO) securityManager.getSubjectDAO();</span><br><span class="line">        <span class="type">DefaultSessionStorageEvaluator</span> <span class="variable">evaluator</span> <span class="operator">=</span> (DefaultSessionStorageEvaluator) defaultSubjectDAO.getSessionStorageEvaluator();</span><br><span class="line">        evaluator.setSessionStorageEnabled(Boolean.FALSE);</span><br><span class="line">        defaultSubjectDAO.setSessionStorageEvaluator(evaluator);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é…ç½®Shiroçš„è®¿é—®ç­–ç•¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">filterFactoryBean</span><span class="params">(DefaultWebSecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        Map&lt;String, Filter&gt; filterMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line">        filterMap.put(<span class="string">&quot;jwt&quot;</span>, <span class="keyword">new</span> <span class="title class_">JwtFilter</span>());</span><br><span class="line">        factoryBean.setFilters(filterMap);</span><br><span class="line">        factoryBean.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; filterRuleMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">8</span>);</span><br><span class="line">        <span class="comment">//ç™»é™†ç›¸å…³apiä¸éœ€è¦è¢«è¿‡æ»¤å™¨æ‹¦æˆª</span></span><br><span class="line">        filterRuleMap.put(<span class="string">&quot;/user/login/**&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">        <span class="comment">// æ‰€æœ‰è¯·æ±‚é€šè¿‡JWT Filter</span></span><br><span class="line">        filterRuleMap.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;jwt&quot;</span>);</span><br><span class="line">        factoryBean.setFilterChainDefinitionMap(filterRuleMap);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æ³¨è§£æ”¯æŒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@DependsOn(&quot;lifecycleBeanPostProcessor&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> DefaultAdvisorAutoProxyCreator <span class="title function_">defaultAdvisorAutoProxyCreator</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">DefaultAdvisorAutoProxyCreator</span> <span class="variable">advisorAutoProxyCreator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultAdvisorAutoProxyCreator</span>();</span><br><span class="line">        advisorAutoProxyCreator.setProxyTargetClass(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span> advisorAutoProxyCreator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æ³¨è§£ä¾èµ–</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> LifecycleBeanPostProcessor <span class="title function_">lifecycleBeanPostProcessor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LifecycleBeanPostProcessor</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¼€å¯æ³¨è§£</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title function_">authorizationAttributeSourceAdvisor</span><span class="params">(DefaultWebSecurityManager securityManager)</span> &#123;</span><br><span class="line">        <span class="type">AuthorizationAttributeSourceAdvisor</span> <span class="variable">advisor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class="line">        advisor.setSecurityManager(securityManager);</span><br><span class="line">        <span class="keyword">return</span> advisor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h3><p>å®ç°UserServiceä¸­çš„loginæ–¹æ³• -&gt; <strong>UserServiceImpl.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.model.User;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.service.UserService;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.wx.model.WxAccount;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.wx.service.WxAccountService;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.wx.util.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/23 11:19</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°:</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> JwtUtil jwtUtil;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> WxAccountService wxAccountService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">login</span><span class="params">(String jsCode)</span> &#123;</span><br><span class="line">        Map&lt;String, String&gt; res = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">WxAccount</span> <span class="variable">wxAccount</span> <span class="operator">=</span> wxAccountService.login(jsCode);</span><br><span class="line">        log.info(<span class="string">&quot;---&gt;&gt;&gt;wxAccountä¿¡æ¯:[&#123;&#125;]&quot;</span>,wxAccount);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectById(wxAccount.getOpenId());</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// todo: ç”¨æˆ·ä¸å­˜åœ¨, æé†’ç”¨æˆ·æäº¤æ³¨å†Œä¿¡æ¯</span></span><br><span class="line">            res.put(<span class="string">&quot;canLogin&quot;</span>,Boolean.FALSE.toString());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            res.put(<span class="string">&quot;canLogin&quot;</span>,Boolean.TRUE.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        res.put(<span class="string">&quot;token&quot;</span>, jwtUtil.sign(wxAccount));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºcontrollerï¼Œç¼–å†™æµ‹è¯•api -&gt; <strong>UserController.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.toolkit.StringUtils;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.controller.res.CodeMsg;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.controller.res.Result;</span><br><span class="line"><span class="keyword">import</span> com.github.gongsir0630.shirodemo.service.UserService;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.SecurityUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.shiro.authz.annotation.RequiresAuthentication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> ç¨‹åºå‘˜Kyleâœ¨ GitHub: https://github.com/gongsir0630</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/3/23 11:12</span></span><br><span class="line"><span class="comment"> * ä½ çš„æŒ‡å°–,æ‹¥æœ‰æ”¹å˜ä¸–ç•Œçš„åŠ›é‡</span></span><br><span class="line"><span class="comment"> * æè¿°: ç”¨æˆ·ä¿¡æ¯æ¥å£ç±»,åŒ…å«å°ç¨‹åºç™»å½•æ³¨å†Œ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä»è®¤è¯ä¿¡æ¯ä¸­è·å–ç”¨æˆ·Id: userId == openId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> userId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getUserId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SecurityUtils.getSubject().getPrincipal().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°ç¨‹åºç”¨æˆ·ç™»å½•æ¥å£: é€šè¿‡js_codeæ¢å–openId, åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»æ³¨å†Œ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code wx.login() å¾—åˆ°çš„codeå‡­è¯</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Result&lt;JSONObject&gt;&gt; <span class="title function_">login</span><span class="params">(String code)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(code)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(Result.fail(<span class="keyword">new</span> <span class="title class_">CodeMsg</span>(<span class="number">401</span>,<span class="string">&quot;code is empty&quot;</span>), <span class="literal">null</span>), HttpStatus.OK);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;---&gt;æ¥æ”¶åˆ°æ¥è‡ªå°ç¨‹åºç«¯çš„code:[&#123;&#125;]&quot;</span>,code);</span><br><span class="line">        <span class="comment">// todo: ä½¿ç”¨ code -&gt; wxAccountService.login() -&gt; openId,session_key</span></span><br><span class="line">        Map&lt;String, String&gt; loginMap = userService.login(code);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">canLogin</span> <span class="operator">=</span> Boolean.parseBoolean(loginMap.get(<span class="string">&quot;canLogin&quot;</span>));</span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> loginMap.get(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        data.put(<span class="string">&quot;token&quot;</span>,token);</span><br><span class="line">        data.put(<span class="string">&quot;canLogin&quot;</span>,canLogin);</span><br><span class="line">        log.info(<span class="string">&quot;---&gt;&gt;&gt;è¿”å›è®¤è¯ä¿¡æ¯:[&#123;&#125;]&quot;</span>, data.toString());</span><br><span class="line">        <span class="keyword">if</span> (!canLogin) &#123;</span><br><span class="line">            <span class="comment">// todo: ç”¨æˆ·ä¸å­˜åœ¨,æç¤ºç”¨æˆ·æ³¨å†Œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(Result.fail(CodeMsg.NO_USER,data),HttpStatus.OK);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(Result.success(data),HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨ RequiresAuthentication æ³¨è§£, éœ€è¦éªŒè¯æ‰èƒ½è®¿é—®</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> userId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="meta">@RequiresAuthentication</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Result&lt;JSONObject&gt;&gt; <span class="title function_">requireAuth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        data.put(<span class="string">&quot;hello&quot;</span>,getUserId());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResponseEntity</span>&lt;&gt;(Result.success(data),HttpStatus.OK);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–å†™å°ç¨‹åºæµ‹è¯•ä»£ç è·å–<code>code</code>ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">login</span>(&#123;</span><br><span class="line">   <span class="attr">timeout</span>: <span class="number">3000</span>,</span><br><span class="line">   <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src= "/blog/img/loading.gif" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4ea0c2f0c10e40bb9d898198fd88d731~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>å¯åŠ¨ <a href="https://github.com/wx-java-miniapp"><code>wx-java-miniapp</code></a>é¡¹ç›®ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef5a62b16daa4687a1924d599037db3e~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>å¯åŠ¨<code>shiro-jwt-demo</code>é¡¹ç›®ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2a4d81669bc4813845add1d598674a0~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>Postmanæµ‹è¯•è®¤è¯ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4f23e79dc4fb4494951768161c67b2f6~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><p>æºå¸¦tokenè®¿é—®ï¼š</p><p><img src= "/blog/img/loading.gif" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70eb9247eedc431d803bfc61484f2ee1~tplv-k3u1fbpfcp-watermark.image" alt="image.png"></p><h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>ä»¥ä¸Šå°±æ˜¯åŸºäºShiroã€JWTå®ç°å¾®ä¿¡å°ç¨‹åºç™»å½•å®Œæ•´ä¾‹å­çš„é€»è¾‘è¿‡ç¨‹è¯´æ˜åŠå…¶å®ç°ã€‚</p><ul><li>å®Œæ•´é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/gongsir0630/shiro-jwt-demo">https://github.com/gongsir0630/shiro-jwt-demo</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸåˆ› </category>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å¾®ä¿¡å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è£è€€åŠ å†•ï¼Œè¿½æ¢¦ä¸ä¼‘ | æˆ‘çš„å¤§å­¦æ—¶å…‰</title>
      <link href="/blog/2021/03/07/my-college-days.html"/>
      <url>/blog/2021/03/07/my-college-days.html</url>
      
        <content type="html"><![CDATA[<p>æ˜é‡‘é˜…è¯»<a href="https://juejin.cn/post/6936888905086009352">åŸæ–‡</a>,ä½“éªŒæ›´å¥½ã€‚</p><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><blockquote><p>â€œæœ‰äº›è¯—å†™ç»™æ˜¨æ—¥å’Œæ˜æ—¥ï¼Œæœ‰äº›è¯—å†™ç»™çˆ±æ‹ï¼Œæœ‰äº›è¯—å†™ç»™ä»æ¥æœªæ›¾è°‹é¢ï¼Œä½†æ˜¯åœ¨æ—¥è½ä¹‹å‰ä¹Ÿä»æœªæ”¾å¼ƒè¿‡çš„ç†æƒ³â€ï¼Œè€Œæˆ‘ï¼Œåˆ™æƒ³å†™ç»™æˆ‘å¦‚è¯—çš„é’æ˜¥â€”â€”æˆ‘çš„å¤§å­¦ã€‚</p></blockquote><p>æˆ‘æ˜¯<a href="https://github.com/gongsir0630">ç¨‹åºå‘˜Kyleâœ¨</a>ï¼Œ2020å¹´9æœˆç§‹æ‹›ä¸Šå²¸KSï¼ŒåŸè®¡åˆ’ç§‹æ‹›ç»“æŸå†™ä¸€ç¯‡æ–‡ç« æ¥æ€»ç»“è‡ªå·±çš„æ ¡æ‹›å†ç¨‹ï¼Œæ— å¥ˆåé¢ä¸€ç›´å¿™äºä¸ªäººé¡¹ç›®å’Œæ¯•è®¾ï¼Œå°±æŠŠè¿™èŒ¬ç»™å¿˜äº†ã€‚æœ€è¿‘çœ‹äº†å¾ˆå¤šå¤§ä½¬ï¼ˆ<a href="https://juejin.cn/post/6903518662620086285">ç²¥é‡Œæœ‰å‹ºç³–</a>ï¼‰è¿™æ–¹é¢ç›¸å…³çš„æ–‡ç« ï¼Œè§‰å¾—è¿˜æ˜¯å¿…é¡»è¦å†™ä¸€ä¸‹ï¼Œç´¢æ€§å°±æŠŠè‡ªå·±è¿™å››å¹´çš„å¤§å­¦ç”Ÿæ´»å¥½å¥½å›å¿†ä¸€ä¸‹ã€‚</p><p>æ—¶é—´æ€»æ˜¯è½¬ç¬å³é€ï¼Œä¸çŸ¥ä¸è§‰ï¼Œæˆ‘ä»¬å³å°†å‘Šåˆ«è¿™å•çº¯ã€ç¾å¥½çš„æ ¡å›­ç”Ÿæ´»ï¼Œå¤§å­¦ç”Ÿæ´»å¯¹æ¯ä¸ªäººæ¥è¯´éƒ½æ˜¯æœ€å®è´µçš„ç»å†ï¼Œæ¯ä¸ªäººçš„ç»å†ä¹Ÿéƒ½å„ä¸ç›¸åŒï¼Œå›é¡¾ä¸€ä¸‹ï¼Œè®°å½•ä¸‹æ¥ï¼Œä¹Ÿå¯ä»¥ç•™ä½œçºªå¿µï¼Œç­‰åˆ°ä»¥åå¯ä»¥å›å‘³ã€‚æˆ–è®¸è¿™æ®µç»å†å¯¹å­¦å¼Ÿå­¦å¦¹ä»¬æœ‰æ‰€å¸®åŠ©ï¼Œå…¶ä¸­çš„ä¸€äº›äº‹æƒ…ï¼Œèƒ½å¤Ÿä½¿ä½ ä»¬å°‘èµ°äº›å¼¯è·¯ã€‚</p><h2 id="è£è€€åŠ å†•"><a href="#è£è€€åŠ å†•" class="headerlink" title="è£è€€åŠ å†•"></a>è£è€€åŠ å†•</h2><p>å›é¡¾è‡ªå·±çš„å¤§å­¦ç”Ÿæ´»ï¼Œè™½å¹¶æ— ä¼ å¥‡è‰²å½©ï¼Œæ™®æ™®é€šé€šï¼Œä½†ä¹Ÿåˆ«æœ‰ä¸€ç•ªæ»‹å‘³ã€‚åˆšæ­¥å…¥å¤§å­¦æ€»å½’æ˜¯æ»¡è„¸çš„å¥½å¥‡ï¼Œæƒ³å»å°è¯•å„ç§æ–°é²œäº‹ç‰©ï¼ˆäº‹æƒ…ï¼‰ï¼Œå¦‚ä»Šå›å¿†èµ·æ¥ï¼Œå¤§å¤§å°å°ä¹ŸåŸºæœ¬ä¸Šéƒ½å®Œæˆäº†ï¼Œä¹Ÿç®—æ˜¯<code>è£è€€åŠ å†•</code>äº†ã€‚</p><ul><li>ç«é€‰ç­å§”</li><li>å¥–å­¦é‡‘</li><li>æ¯”èµ›</li><li>ç¤¾å›¢</li><li>æ‹çˆ±</li><li>å‹¤å·¥åŠ©å­¦</li><li>â€¦<h3 id="èµ·èˆª-æ¢¦æƒ³å¼€å§‹çš„åœ°æ–¹"><a href="#èµ·èˆª-æ¢¦æƒ³å¼€å§‹çš„åœ°æ–¹" class="headerlink" title="èµ·èˆª | æ¢¦æƒ³å¼€å§‹çš„åœ°æ–¹"></a>èµ·èˆª | æ¢¦æƒ³å¼€å§‹çš„åœ°æ–¹</h3><h4 id="å¿—æ„¿"><a href="#å¿—æ„¿" class="headerlink" title="å¿—æ„¿"></a>å¿—æ„¿</h4><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/573547b95bfa4b6b8a517aed14e273e0~tplv-k3u1fbpfcp-zoom-1.image" alt="my school"><br>è‡ªå·±ä»åˆä¸­å¼€å§‹å°±å¯¹è®¡ç®—æœºé¢†åŸŸå……æ»¡å¥½å¥‡ï¼Œé‚£æ—¶è‡ªå·±åœ¨ç©ç”µè„‘ï¼ˆä¸å¸¦æ‰“æ¸¸æˆçš„ï¼‰æ–¹é¢ä¹Ÿç®—æ˜¯ç­ä¸Šæ•°ä¸€æ•°äºŒçš„ï¼Œé‚£æ—¶å¿ƒé‡Œå°±æƒ³ï¼šå¤§å­¦ä¸€å®šè¦å­¦è®¡ç®—æœºï¼Œæ¯«æ— æ„å¤–æˆ‘é«˜è€ƒå¿—æ„¿é€‰æ‹©äº†<code>è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯</code>ä¸“ä¸šï¼Œå¼€å§‹äº†æˆ‘çš„Codingä¹‹è·¯ã€‚<blockquote><p>ç”¨æˆ‘çš„æŒ‡å°–å®ç°æˆ‘çš„æŠ€æœ¯æ¢¦</p></blockquote><h4 id="å¼€å­¦-amp-å†›è®­"><a href="#å¼€å­¦-amp-å†›è®­" class="headerlink" title="å¼€å­¦&amp;å†›è®­"></a>å¼€å­¦&amp;å†›è®­</h4>2017å¹´9æœˆï¼Œå¼€å­¦ç¬¬ä¸€å¤©è¦å»è®¤è¯†ä¸‹é‚£äº”ä¸ªå¯ï¼ˆhanï¼‰çˆ±ï¼ˆhanï¼‰<code>å®¤å‹</code>ï¼Œæ¯•ç«Ÿè¦ä¸€èµ·èµ°å®Œå››å¹´å¤§å­¦ç”Ÿæ´»ï¼Œä»¥åè¿˜å¾—é ä»–ä»¬è·‘è·‘è…¿ã€å¸¦å¸¦é¥­ä»€ä¹ˆçš„ï¼Œå¿…é¡»å¾—å…ˆæå¥½å…³ç³»ã€‚</li></ul><p><strong>æŠ¥é“è¿™å¤©è¿˜è®¤è¯†ä¸€ä¸ª<code>å­¦å§</code>ï¼Œå¥¹æ˜¯<code>è®¡ç®—æœºåä¼š</code>çš„ä¼šé•¿ï¼Œå¸¦æˆ‘ä»¬è½¬äº†ä¸€ä¸‹æ ¡å›­ï¼Œæœ€åå»å¥¹ä»¬çš„ç¤¾å›¢æ‘Šä½çœ‹äº†ä¸€ä¸‹ã€‚ï¼ˆç‰¹æ„æåŠï¼Œç¤¾å›¢æ•…äº‹çº¿çš„å¼€å§‹ï¼‰</strong></p><p>åé¢çš„æ—¥å­å°±æ˜¯ä¸€äº›ä»€ä¹ˆå¼€å­¦å…¸ç¤¼ã€<code>è‹±è¯­åˆ†çº§è€ƒè¯•</code>ï¼ˆå±…ç„¶è¿˜æœ‰è¿™ç©æ„å„¿ï¼‰ã€é€‰è¯¾ä¹‹ç±»çš„â€¦</p><p>å°è±¡æ·±åˆ»çš„æ˜¯ä½“æ£€ï¼Œå› ä¸ºè‡ªèº«èº«ä½“åŸå› ï¼Œå’Œæ ¡å›­ç­¾äº†ä¸ªä»€ä¹ˆåè®®ï¼ŒåŒ»ç”Ÿå‘Šè¯‰æˆ‘äº¤ç»™è¾…å¯¼å‘˜ï¼Œç„¶åä¸ç”¨å‚åŠ å†›è®­ã€‚ï¼ˆç°åœ¨æƒ³æƒ³å¯æƒœäº†é‚£ç«¯å†›è®­æ—¶å…‰ï¼Œæˆ‘åº”è¯¥å»å‚åŠ çš„ï¼‰</p><h4 id="ç«é€‰ç­å§”-amp-å­¦ç”Ÿä¼š"><a href="#ç«é€‰ç­å§”-amp-å­¦ç”Ÿä¼š" class="headerlink" title="ç«é€‰ç­å§”&amp;å­¦ç”Ÿä¼š"></a>ç«é€‰ç­å§”&amp;å­¦ç”Ÿä¼š</h4><p>â€œä¸ºä»€ä¹ˆè¯´è¿™ä¸€æ®µå‘¢ï¼Ÿâ€</p><p>â€œå› ä¸ºæˆ‘æ„Ÿè§‰æˆ‘çš„è£è€€ä¹‹è·¯å°±æ˜¯ä»è¿™ä¸€æ®µæ•…äº‹å¼€å§‹çš„â€</p><p>10æœˆå›½åº†æ”¶å‡ï¼Œç«é€‰ç­å§”ï¼Œæˆ‘æƒ³å»ç«é€‰ç­é•¿ï¼Œä¸è¿‡æˆ‘æ²¡æœ‰å‚åŠ å†›è®­ï¼Œå’Œç­çº§åŒå­¦æ¥è§¦ä¸å¤šï¼Œä¼°è®¡æ”¯æŒè€…ä¸å¤šï¼Œå¥½åœ¨æˆ‘åœ¨å‰æœŸä¹Ÿå¸®åŠ©äº†è®¸å¤šç­çº§åŒå­¦ï¼Œæ„Ÿè§‰äººå‘˜è¿˜ä¸é”™ï¼ˆpsï¼šååŠ©ç­å¯¼<code>å°å§å§</code>ç»„ç»‡åŒå­¦ä»¬å¡«ä¿¡æ¯ä¹‹ç±»çš„ï¼Œå¼€å­¦å„ç§ä¿¡æ¯ã€ææ–™è¦å¡«ï¼‰ã€‚</p><p>å½“æ—¶ç«é€‰ç­é•¿å°±æˆ‘è·Ÿå¦ä¸€ä¸ªä»£å·ä¸º<code>H</code>çš„åŒå­¦ï¼Œç´§å¼ åˆºæ¿€çš„ç«é€‰è‡´è¾ç»“æŸåï¼Œæœ€ç»ˆç»“æœæˆ‘ä¿©å¹³ç¥¨ï¼ˆå…¶å®ç»“æœè¿™æ ·æˆ‘å·²ç»å¾ˆæ»¡æ„äº†ï¼‰ï¼Œç´¢æ€§å°±è®©ä»–å½“äº†ç­é•¿ã€‚</p><p>å°±è¿™æ ·ï¼Œæˆ‘å¤§å­¦çš„ç¬¬ä¸€æ¬¡failureã€‚ç«é€‰ç»“æŸåï¼Œæˆ‘è·Ÿ<code>H</code>ä¸€èµ·å»åƒäº†é¥­ï¼Œä¸æ‰“ä¸ç›¸è¯†ï¼Œåæ¥æˆ‘ä»¬æˆä¸ºäº†æœ€å¥½çš„æœ‹å‹ã€‚<br><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b770035a9ab451ebc7ea9af206fdeb5~tplv-k3u1fbpfcp-zoom-1.image" alt="H&#39;s Photo"></p><hr><p>ç­å§”ç«é€‰å¤±åˆ©ï¼Œå­¦ç”Ÿä¼šæ‹›æ–°åˆå¼€å§‹äº†ï¼Œå»å°è¯•äº†å‡ ä¸ªï¼Œä¸€é¢éƒ½éƒ½è¿‡äº†ï¼Œä¸çŸ¥é“ä¸ºå•¥äºŒé¢åªèƒ½å»ä¸€ä¸ªï¼ˆè¿˜å¥½æ‰¾å·¥ä½œé¢è¯•ä¸æ˜¯è¿™æ ·çš„ï¼‰ï¼Œç»“æœäºŒé¢æŒ‚äº†ï¼Œå“ï¼Œå½“æ—¶çœŸçš„æœ‰ç‚¹éš¾å—ã€‚</p><p>åˆšå…¥å­¦ï¼Œæ¥è¿å—æŒ«ï¼Œå¿ƒæœ‰ä¸ç”˜ï¼Œå‘äº†ä¸ªåŠ¨æ€ï¼Œæ¥å—äº‹å®ï¼Œå¥½å¥½å­¦ä¹ ï¼š</p><ul><li>äºŒ-ä¸‰å‘¨æ—¶é—´çœ‹äº†è€ƒç ”é«˜æ•°è§†é¢‘ï¼Œå­¦æ ¡çš„é¢˜åšèµ·æ¥å°±é‚£æ ·</li><li>å‰©ä¸‹æ—¶é—´éƒ½å»å­¦Cè¯­è¨€ã€åˆ·é¢˜ï¼Œäº†è§£ä¸‹æ•°æ®ç»“æ„</li></ul><h4 id="ç½‘ä¿¡æ‹›æ–°ï¼Œæœºä¼šæ¥äº†"><a href="#ç½‘ä¿¡æ‹›æ–°ï¼Œæœºä¼šæ¥äº†" class="headerlink" title="ç½‘ä¿¡æ‹›æ–°ï¼Œæœºä¼šæ¥äº†"></a>ç½‘ä¿¡æ‹›æ–°ï¼Œæœºä¼šæ¥äº†</h4><p>11æœˆçš„æŸä¸€å¤©ï¼Œç­çº§ä¿¡æ¯é€šçŸ¥ç¾¤æ¥äº†ä¸€åˆ™ç½‘ä¿¡å›¢é˜Ÿæ‹›æ–°æµ·æŠ¥ï¼Œå›¢é˜Ÿä¸»è¦åšå­¦æ ¡ç½‘ç»œç»´æŠ¤å·¥ä½œï¼Œåº”è¯¥å¾ˆé€‚åˆæˆ‘ï¼Œå»è¯•è¯•å§ã€‚æ‹¿èµ·æ‰‹æœºå‘äº†æŠ¥åçŸ­ä¿¡ã€‚</p><p>é€šè¿‡äº†ä¸€é¢ï¼Œå¼€å¯äº†ä¸€ä¸ªæœˆçš„å›¢é˜Ÿå®ä¹ ï¼ˆå›¢é˜Ÿéœ€è¦ä¸€å®šçš„æŠ€æœ¯é€‚åº”ä»¥åŠæˆå‘˜ç£¨åˆï¼‰ï¼Œä¸€ä¸ªæœˆä¹‹åï¼Œæˆ‘ä»12åå®ä¹ é€‰æ‰‹ä¸­è„±é¢–è€Œå‡ºï¼ŒæˆåŠŸåŠ å…¥äº†è¿™ä¸ªå›¢é˜Ÿã€‚</p><p>å¤§ä¸‰çš„æ—¶å€™ï¼Œæˆä¸ºäº†<code>å›¢é˜Ÿé˜Ÿé•¿</code>ï¼Œæˆ‘åœ¨è¿™ä¸ªå›¢é˜Ÿä»å¤§ä¸€ä¸€ç›´è‚åˆ°äº†å¤§ä¸‰ç»“æŸï¼Œå¯ä»¥è¯´ï¼Œå¤§å­¦ç”Ÿæ´»å¤§éƒ¨æ—¶é—´æˆ‘éƒ½å’Œè¿™é‡Œçš„å°ä¼™ä¼´å¾…åœ¨ä¸€èµ·ï¼Œè¿™é‡Œæœ‰å¾ˆå¤šçš„æœ‰è¶£çš„æ•…äº‹ï¼Œæˆ‘ä¹Ÿæ”¶è·äº†å¾ˆå¤šï¼š</p><ul><li>æœ‹å‹ï¼šæˆ‘ä»¬ä¸€èµ·å€¼ç­ã€å­¦ä¹ ã€ç©æ¸¸æˆã€å›¢å»º</li><li>å›¢é˜Ÿï¼šä¸å¿˜åˆå¿ƒï¼Œç ¥ç ºå‰è¡Œ | æˆ‘æ„¿ç§°ä¹‹ä¸º <strong><code>â€œæœ€å¥½çš„æˆ‘ä»¬â€</code></strong></li><li>é¡¹ç›®ï¼šä¸ºäº†ç®€åŒ–å›¢é˜ŸåŠå…¬ï¼Œæˆ‘ä»¬è‡ªç ”äº†åŠå…¬ç³»ç»Ÿ</li><li>èµ„æºï¼šå’Œé¢†å¯¼è€å¸ˆä¸€èµ·äº¤æµå­¦ä¹ ã€å‚ä¸ç§‘ç ”é¡¹ç›®</li><li>å·¥èµ„ï¼šå›¢é˜Ÿå±äºå‹¤å·¥åŠ©å­¦ï¼Œæ¯æœˆå¯ä»¥æ‹¿é…¬é‡‘<br><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1ae908754fb04cf1ae28d79292080283~tplv-k3u1fbpfcp-zoom-1.image" alt="æœ€å¥½çš„æˆ‘ä»¬"></li></ul><h4 id="è®¡åæˆ‘æ¥äº†"><a href="#è®¡åæˆ‘æ¥äº†" class="headerlink" title="è®¡åæˆ‘æ¥äº†"></a>è®¡åæˆ‘æ¥äº†</h4><p><strong>è¿˜è®°å¾—æŠ¥é“æ³¨å†Œé‚£å¤©çš„è®¡åå­¦å§å—ï¼Ÿ</strong> æ²¡é”™æˆ‘å’Œè®¡åçš„æ•…äº‹å¤§æ¦‚æ˜¯2018å¹´3æœˆçš„æ—¶å€™å¼€å§‹çš„ã€‚æˆ‘è¿›å»äº†æ˜ç†æ¥¼C1001æˆ¿é—´é¢è¯•<code>ç¤¾å›¢ç†äº‹</code>ï¼Œæˆ–è®¸å› ä¸ºæˆ‘çš„é¢œå€¼ï¼ˆå­¦å§è¯´è®¡åé é¢œå€¼æ‹›äººï¼‰å¤Ÿé«˜ï¼Œä¸€åˆ‡éƒ½æ˜¯é‚£ä¹ˆé¡ºåˆ©ï¼Œæˆ‘æˆåŠŸåŠ å…¥äº†è®¡åè¿™ä¸ªå¤§å®¶åº­ã€‚<br><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6c2053754f88485e80deaa37f8b47d7c~tplv-k3u1fbpfcp-zoom-1.image" alt="è®¡ååå››å±Šå›¢é˜Ÿæˆå‘˜"><br>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸€èµ·ä¸¾åŠ<code>ç”µè„‘ä¹‰è¯Š</code>æ´»åŠ¨ä¸ºå…¨æ ¡å¸ˆç”Ÿè§£å†³ç”µè„‘é—®é¢˜ï¼Œå¾—åˆ°äº†å¾ˆå¤šå¸ˆç”Ÿçš„æ”¯æŒä¸é¼“åŠ±ã€‚2018å¹´6æœˆï¼Œæˆ‘è£å¹¸çš„é€šè¿‡å­¦é™¢ç¤¾å›¢è”é¢è¯•ï¼Œæˆä¸ºäº†<code>ç¬¬åå››å±Šè®¡ç®—æœºåä¼šä¼šé•¿</code>ï¼Œé‚£ä¸€åˆ»ï¼Œè£è€€åŠ å†•çš„åŒæ—¶ï¼Œæ›´é‡å¤§çš„æ˜¯è‚©ä¸Šçš„è´£ä»»ã€‚<br><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e73a1cc9b2af43bb9499cf9cabd0a939~tplv-k3u1fbpfcp-zoom-1.image" alt="ä¼˜ç§€ä¼šé•¿"><br>åœ¨è®¡åå‰å‰ååå‘†äº†ä¸€å¹´å¤šæ—¶é—´ï¼Œè§è¯äº†è®¡åå‡ æ¬¡å¤§çš„å˜åŠ¨ï¼Œä»å­¦å§æŠŠç¤¾å›¢äº¤åˆ°æˆ‘ä»¬æ‰‹ä¸­é‚£ä¸€åˆ»èµ·ï¼Œåšå¥½ç¤¾å›¢æ—¥å¸¸ç®¡ç†å·¥ä½œçš„åŒæ—¶ï¼Œå¸¦é¢†ç†äº‹ä¸¾åŠæ›´å¤šæœ‰æ„ä¹‰çš„æ´»åŠ¨ï¼Œæ‰“é€ æ˜Ÿçº§å“ç‰Œç¤¾å›¢æ˜¯æˆ‘ä»¬çš„ç›®æ ‡ã€‚æ­¤æ—¶å†çœ‹è®¡åï¼Œä»Šéæ˜”æ¯”ï¼ˆ<code>æ ¡å›­äº”æ˜Ÿçº§ç¤¾å›¢</code>ï¼‰ã€‚</p><h4 id="å°ç»“-amp-å¯„è¯­"><a href="#å°ç»“-amp-å¯„è¯­" class="headerlink" title="å°ç»“&amp;å¯„è¯­"></a>å°ç»“&amp;å¯„è¯­</h4><p>åœ¨å¤§å­¦ä¸€å®šè¦ç»™è‡ªå·±æ‰¾ç‚¹äº‹å¹²ï¼ˆå¤©å¤©æ³¡å›¾ä¹¦é¦†çš„å­¦ç¥è¯·æ— è§†ï¼‰ï¼Œä¸è¦è®©è‡ªå·±é—²ä¸‹æ¥ã€‚ç­å§”ã€å­¦ç”Ÿä¼šã€ç¤¾å›¢ã€å‹¤å·¥åŠ©å­¦ç­‰ç­‰ï¼Œéƒ½å¯ä»¥è¯•ç€å»å‚ä¸ï¼ŒåŸ¹å…»è‡ªå·±çš„å…´è¶£çˆ±å¥½ï¼Œç»“äº¤ä¸€äº›è‰¯å¸ˆç›Šå‹ï¼ˆæ‰¾åˆ°ä½ çš„é‚£ä¸ªä»–/å¥¹ä¹Ÿè¯´ä¸å®šå•Šï¼‰ã€‚</p><h3 id="æˆ‘ä¹Ÿæ›¾åŠªåŠ›å­¦ä¹ "><a href="#æˆ‘ä¹Ÿæ›¾åŠªåŠ›å­¦ä¹ " class="headerlink" title="æˆ‘ä¹Ÿæ›¾åŠªåŠ›å­¦ä¹ "></a>æˆ‘ä¹Ÿæ›¾åŠªåŠ›å­¦ä¹ </h3><h4 id="è¯¾ç¨‹å­¦ä¹ "><a href="#è¯¾ç¨‹å­¦ä¹ " class="headerlink" title="è¯¾ç¨‹å­¦ä¹ "></a>è¯¾ç¨‹å­¦ä¹ </h4><p>åŠ å…¥äº†ç½‘ä¿¡å›¢é˜Ÿä¹‹åï¼Œæ¯å‘¨å€¼å¤§æ¦‚4-5èŠ‚ç­ï¼ˆå€¼ç­æœŸé—´æœ‰å·¥ä½œå¿™å·¥ä½œï¼Œæ²¡å·¥ä½œå°±å­¦æŠ€æœ¯ï¼‰ï¼Œæˆ‘å¾ˆå°‘æŠŠæ—¶é—´èŠ±åœ¨è¯¾ç¨‹å­¦ä¹ ä¸Šé¢ï¼Œé™¤äº†ä¸“ä¸šè¯¾ä¹‹å¤–ï¼Œå…¶ä»–éƒ½æ˜¯è€ƒå‰é¢„ä¹ ï¼ˆå…¶å®è¿˜æ˜¯è¦çœ‹ä¸ªäººå­¦ä¹ èƒ½åŠ›æ¥å†³å®šï¼Œå­¦å¼Ÿå­¦å¦¹ä¸å¤ªå»ºè®®æ¨¡ä»¿ï¼‰ã€‚</p><p>ä¸“ä¸šè¯¾å­¦ä¹ æˆ‘è¿˜æ˜¯å¾ˆè®¤çœŸçš„ï¼Œä¾‹å¦‚Cè¯­è¨€ã€æ•°æ®ç»“æ„ã€C++ç­‰æ ¸å¿ƒè¯¾ç¨‹ï¼Œçœ‹çœ‹è¯­æ³•ï¼Œåˆ·é¢˜ï¼Œå› ä¸ºè¿™äº›è¯¾ç¨‹ä¸æ­¢åº”ä»˜å­¦æ ¡çš„è€ƒæ ¸ï¼Œä»¥åè¦é è¿™åƒé¥­ï¼ˆä¸è¿‡æˆ‘ä¸æ˜¯èµ°çš„C/C++ï¼‰ã€‚</p><h4 id="æŠ€æœ¯æå‡"><a href="#æŠ€æœ¯æå‡" class="headerlink" title="æŠ€æœ¯æå‡"></a>æŠ€æœ¯æå‡</h4><p>å¤§ä¸€ç»“æŸåï¼Œæ‰‹ä¸Šåªä¼šCå’ŒDSï¼Œä»€ä¹ˆé¡¹ç›®ä¹Ÿå†™ä¸å‡ºæ¥ï¼Œä¸€æƒ³ï¼Œè¿™ä¸è¡Œå•Šï¼Œçœ‹äº†çœ‹æœ¬ä¸“ä¸šçš„åŸ¹å…»æ–¹æ¡ˆï¼š</p><ul><li>C++å¿…ä¿®</li><li>è®¡ç½‘ã€OSå¿…ä¿®</li><li>å‰ç«¯é€‰ä¿®</li><li>C#é€‰ä¿®</li><li>å‰©ä¸‹å…¨æ˜¯åµŒå…¥å¼<br>ä¸ªäººå¯¹åµŒå…¥å¼å¼€å‘ä¸æ„Ÿå…´è¶£ï¼Œbutä¸“ä¸šåŸ¹å…»æ–¹å‘å°±æ˜¯åµŒå…¥å¼å¼€å‘ï¼Œè½¬ä¸“ä¸šå·²ç»æ™šäº†ä¹Ÿæ²¡å¿…è¦ã€‚ç´¢æ€§æˆ‘å°±æ ¹æ®åŸ¹å…»æ–¹æ¡ˆä¿®äº†<code>C++</code>ã€<code>C#</code>ã€å‰ç«¯ï¼Œå¹¶ä¸”è‡ªå­¦äº†å½“æ—¶å¾ˆç«çš„<code>Java</code>ï¼Œå½“æˆ‘åœ¨<code>Vscode</code>å†™ä¸‹ä»¥ä¸‹ä»£ç çš„æ—¶å€™ï¼Œæˆ‘å°±å†³å®šäº†æˆ‘çš„æŠ€æœ¯æ–¹å‘-&gt;<strong><code>Java</code></strong>-&lt;:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;Hello Java!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>ç´§æ¥ç€å­¦ä¹ äº†ï¼š</li><li>JavaSe</li><li>JavaEe</li><li>jsp/servlet</li><li>MySQL</li><li>Linux</li><li>spring</li><li>å·¥å…·ï¼šGitHubã€Gitã€IDEAã€Navicatã€Mavenç­‰</li></ul><p>å¤§ä¸‰çš„æ—¶å€™å› ä¸ºè¦å‚åŠ ä¸€äº›è¯¾è®¾å’Œæ¯”èµ›ï¼Œåˆå­¦ä¹ äº†ï¼š</p><ul><li>Javaæ¡†æ¶ï¼šssm/sshã€spring-boot</li><li>å°ç¨‹åºå¼€å‘</li><li>redisã€mqç­‰ä¸­é—´ä»¶</li><li>dubboã€Zookeeper</li><li>hadoopã€mpã€hiveç­‰å¤§æ•°æ®åŸºç¡€</li><li>CI/CD/DevOpsç­‰</li></ul><h4 id="æ¯”èµ›"><a href="#æ¯”èµ›" class="headerlink" title="æ¯”èµ›"></a>æ¯”èµ›</h4><p>ä¸€è¾¹å­¦ä¹ ï¼Œä¸€è¾¹å®è·µï¼Œå°è¯•å‚åŠ å„ç±»æ¯”èµ›ï¼š</p><ul><li>2018Linuxçº¢å¸½æŒ‘æˆ˜èµ›</li><li>å…¨å›½å¤§å­¦ç”Ÿè®¡ç®—æœºæŠ€èƒ½åº”ç”¨å¤§èµ›Cè®¾è®¡</li><li>æ ¡çº§å¼€æ”¾å®éªŒ</li><li>ç››ç‰¹æ¯ã€æŒ‘æˆ˜æ¯</li><li>å¾®ä¿¡å°ç¨‹åºå¼€å‘å¤§èµ›</li><li>æœåŠ¡å¤–åŒ…åˆ›æ–°åˆ›ä¸šå¤§èµ›</li><li>åäº‘è½¯åˆ›</li></ul><h4 id="æ‹¿è¿‡å¥–å­¦é‡‘"><a href="#æ‹¿è¿‡å¥–å­¦é‡‘" class="headerlink" title="æ‹¿è¿‡å¥–å­¦é‡‘"></a>æ‹¿è¿‡å¥–å­¦é‡‘</h4><p>å­¦åˆ†ç»©ç‚¹å¹´çº§å‰20%ï¼Œç»¼åˆæˆç»©å¹´çº§ç¬¬ä¸‰ã€‚</p><ul><li>å›½å®¶åŠ±å¿—ã€æ™¶å¥‡ç½‘ç»œå¥–å­¦é‡‘</li><li>æ ¡çº§ä¸€ã€äºŒã€ä¸‰ç­‰å¥–å­¦é‡‘éƒ½æ°´è¿‡</li><li>ä¼˜ç§€å›¢å‘˜ã€ä¸‰å¥½ã€ä¼˜ç§€å‹¤å·¥åŠ©å­¦</li><li>å¹´åº¦ä¼˜ç§€ä¼šé•¿ç­‰ç­‰</li></ul><h4 id="å°ç»“-amp-å¯„è¯­-1"><a href="#å°ç»“-amp-å¯„è¯­-1" class="headerlink" title="å°ç»“&amp;å¯„è¯­"></a>å°ç»“&amp;å¯„è¯­</h4><ul><li>æ‰¾å‡†è‡ªå·±çš„æŠ€æœ¯æ–¹å‘ï¼Œä¸æ–­å­¦ä¹ æå‡ï¼Œå¤šçœ‹ç›¸å…³æ–‡ç« ï¼Œå°è¯•è‡ªå·±å†™åšå®¢</li><li>æœ‰ä¸€å®šæŠ€æœ¯ä¹‹åï¼Œå’ŒåŒå­¦ç»„é˜Ÿå‚åŠ ä¸€äº›å­¦ç§‘ç«èµ›ï¼Œä»é›¶å¼€å§‹å†™ä¸€äº›é¡¹ç›®</li><li>å­¦ä¹ è¯¾ç¨‹ä¹Ÿå¾—æŠ“ç´§ï¼Œç»©ç‚¹èƒ½æå°±é«˜ä¸€ç‚¹ï¼Œæ‹¿ç‚¹å¥–å­¦é‡‘ä¹Ÿå¯ä»¥ç»­è´¹æœåŠ¡å™¨</li></ul><h3 id="æˆ‘çš„ç¬¬ä¸€ä»½å®ä¹ "><a href="#æˆ‘çš„ç¬¬ä¸€ä»½å®ä¹ " class="headerlink" title="æˆ‘çš„ç¬¬ä¸€ä»½å®ä¹ "></a>æˆ‘çš„ç¬¬ä¸€ä»½å®ä¹ </h3><p>2019å¹´5æœˆï¼Œå¤§äºŒå³å°†ç»“æŸï¼Œæƒ³æ‰¾ä¸€ä»½å®ä¹ ï¼Œå€Ÿç€å­¦é•¿å­¦å§çš„æ¨¡æ¿ï¼Œä¹¦å†™äº†äººç”Ÿä¸­çš„ç¬¬ä¸€ä»½ç®€å†ï¼Œæœºç¼˜å·§åˆä¹‹ä¸‹ï¼Œæ¥åˆ°äº†å°ç±³Hrçš„ç”µè¯ï¼Œçº¦ç”µè¯é¢è¯•æ—¶é—´ã€‚</p><p>ç¬¬ä¸€æ¬¡é¢è¯•ï¼Œè™½ç„¶ä¸æ˜¯é¢å¯¹é¢ï¼Œä½†è¿˜æ˜¯å¾ˆç´§å¼ çš„ï¼Œè¡¨è¿°ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œå¥½åœ¨ç»“æœæ˜¯å¥½çš„ï¼Œä¸€å‘¨ä¹‹åï¼ŒæˆåŠŸæ‹¿åˆ°äººç”Ÿä¸­ç¬¬ä¸€ä¸ª<code>offer</code>ã€‚<br><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ff8497184bb342fc9a8326062335ecc2~tplv-k3u1fbpfcp-zoom-1.image" alt="å°ç±³offer"><br>7æœˆæ­£å¼å®ä¹ å…¥èŒï¼Œå°ç±³åŒå­¦å¾ˆniceï¼Œè§£é”æ–°æˆå°±ï¼š</p><ul><li>äººç”Ÿç¬¬ä¸€å¼ å·¥å¡</li><li>åŒæ˜¾+é«˜é…ä¸»æœº</li><li>ç¬¬ä¸€æ¬¡å‚ä¸åˆ°ä¸€ä¸ªæœ‰å¤šèŒèƒ½äººå‘˜(PMï¼ŒUIï¼ŒFEï¼ŒRD)çš„é¡¹ç›®ä¸­ï¼Œä»¥å‰éƒ½æ˜¯å•å¹²æˆ–è€…å’ŒåŒå­¦ä¸€èµ·ï¼Œæ‹è„‘é—¨å­å¼€å‘</li><li>ç¬¬ä¸€æ¬¡ç©å¾·å·è¿˜äº¤äº†å­¦è´¹<br>å…¥èŒåˆšå¥½èµ¶ä¸Šäº†éƒ¨é—¨å›¢å»ºï¼Œå»äº†åŒ—äº¬é™è¥¿è°·ï¼Œå’Œå¤§ä½¬ä»¬ä¸€èµ·å–èŒ¶ã€æ‹ç…§ã€‚<br><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9894d29aca53467f9521a130f2fc3ce6~tplv-k3u1fbpfcp-zoom-1.image" alt="å°ç±³åŒäº‹"></li></ul><h3 id="æˆ‘æˆä¸ºäº†å¿«æ‰‹äºº"><a href="#æˆ‘æˆä¸ºäº†å¿«æ‰‹äºº" class="headerlink" title="æˆ‘æˆä¸ºäº†å¿«æ‰‹äºº"></a>æˆ‘æˆä¸ºäº†å¿«æ‰‹äºº</h3><p>20å¹´8æœˆï¼Œå‚åŠ ç§‹æ‹›ï¼Œæœ€ç»ˆé€‰æ‹©åˆ™ç­¾çº¦å¿«æ‰‹ï¼Œå¸®åŠ©å¤§å®¶<code>æ‹¥æŠ±æ¯ä¸€ç§ç”Ÿæ´»</code>ã€‚<br><img src= "/blog/img/loading.gif" data-src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/61c4662be9eb4ca5a387e16aab4889c1~tplv-k3u1fbpfcp-zoom-1.image" alt="ks"></p><h3 id="ç”Ÿæ´»"><a href="#ç”Ÿæ´»" class="headerlink" title="ç”Ÿæ´»"></a>ç”Ÿæ´»</h3><ul><li>20å¹´11æœˆæ­£å¼åŠ å…¥ä¸­å›½å…±äº§å…š</li><li>è°ˆè¿‡ä¸¤æ¬¡ä¸é•¿ä¸çŸ­çš„æ‹çˆ±</li><li><code>ç‹è€…è£è€€</code>ä¼ è¯´çº§åˆ«æ‰“é‡é€‰æ‰‹</li><li>å¤§å·´å±±å‡ºæ¥çš„å­©å­ï¼Œè¯»ä¹¦åœ¨æˆéƒ½ï¼Œå·¥ä½œå»åŒ—äº¬</li></ul><h3 id="æ”¶è·"><a href="#æ”¶è·" class="headerlink" title="æ”¶è·"></a>æ”¶è·</h3><h4 id="ä¸€ç¾¤å¾ˆniceçš„æœ‹å‹"><a href="#ä¸€ç¾¤å¾ˆniceçš„æœ‹å‹" class="headerlink" title="ä¸€ç¾¤å¾ˆniceçš„æœ‹å‹"></a>ä¸€ç¾¤å¾ˆniceçš„æœ‹å‹</h4><p>è‡´æ–‡ä¸­çš„<code>å®¤å‹</code>ã€<code>å­¦å§</code>ã€<code>å°å§å§</code>ã€<code>H</code>ã€<code>æœ€å¥½çš„æˆ‘ä»¬</code>ã€<code>è®¡å</code>ï¼Œè¿˜æœ‰ä¸€äº›æœªæåŠçš„æœ‹å‹ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">èšæ˜¯ä¸€å›¢ğŸ”¥</span><br><span class="line">æ•£æ˜¯æ»¡å¤©ğŸŒŸ</span><br><span class="line">æ„¿ä½ ä»¬å‰è·¯å¹³å®‰</span><br><span class="line">æ¡¥éƒ½åšå›º éš§é“å…‰æ˜</span><br><span class="line">æ„¿ä½ ä»¬æ­¤å»è¡Œæ­¢ç”±â¤ï¸</span><br><span class="line">å¾—å¿æ‰€æ„¿</span><br></pre></td></tr></table></figure><h4 id="æ»¡æ„çš„offer"><a href="#æ»¡æ„çš„offer" class="headerlink" title="æ»¡æ„çš„offer"></a>æ»¡æ„çš„offer</h4><p>ç§‹æ‹›çš„ç»“æœï¼Œè‡ªå·±è¿˜æ˜¯å¾ˆæ»¡æ„çš„ï¼Œæ„Ÿè°¢å„ä½é¢è¯•å®˜çš„èµæ•™</p><h4 id="è¿˜ç®—ä¸é”™çš„å­¦ä¸š"><a href="#è¿˜ç®—ä¸é”™çš„å­¦ä¸š" class="headerlink" title="è¿˜ç®—ä¸é”™çš„å­¦ä¸š"></a>è¿˜ç®—ä¸é”™çš„å­¦ä¸š</h4><ul><li>æ ¡çº§ä¼˜ç§€æ¯•ä¸šç”Ÿ</li><li>çœçº§ä¼˜ç§€æ¯•ä¸šç”Ÿ</li></ul><h4 id="çˆ±æƒ…"><a href="#çˆ±æƒ…" class="headerlink" title="çˆ±æƒ…"></a><del>çˆ±æƒ…</del></h4><p><img src= "/blog/img/loading.gif" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e565d754f63640e8a41d0f1841ce963a~tplv-k3u1fbpfcp-watermark.image" alt="çˆ±æƒ…"></p><h3 id="æ„Ÿæ©"><a href="#æ„Ÿæ©" class="headerlink" title="æ„Ÿæ©"></a>æ„Ÿæ©</h3><p>å››å¹´ä¸­é‡åˆ°äº†å¾ˆå¤šäººå’Œäº‹ç‰©ï¼Œæ„Ÿè°¢ä½ ä»¬åœ¨å­¦ä¹ ã€ç”Ÿæ´»ã€å·¥ä½œä¸Šå¯¹æˆ‘æå¤§çš„å¸®åŠ©ã€‚</p><p>æ„¿æˆ‘çˆ±çš„äººå’Œçˆ±æˆ‘çš„äººçæƒœï¼æ„Ÿæ©ï¼å¹¸ç¦ï¼</p><h2 id="è¿½æ¢¦ä¸ä¼‘"><a href="#è¿½æ¢¦ä¸ä¼‘" class="headerlink" title="è¿½æ¢¦ä¸ä¼‘"></a>è¿½æ¢¦ä¸ä¼‘</h2><h3 id="å½“ä¸‹TODO"><a href="#å½“ä¸‹TODO" class="headerlink" title="å½“ä¸‹TODO"></a>å½“ä¸‹TODO</h3><ul><li>å’Œå‘¨å›´åŒå­¦åŸºäº<code>ã€çŸ¥è¯†æ˜Ÿçƒã€‘</code>ç»„ç»‡äº†ä¸€ä¸ªæ ¡å†…æ ¡æ‹›æŒ‡å¯¼æœåŠ¡å¹³å°</li><li>åŸºäºå¾®ä¿¡å°ç¨‹åºï¼Œè‡ªç ”å®ç°è¿™ä¸ªå¹³å°<br><img src= "/blog/img/loading.gif" data-src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90b2bbe50dee49dc8c2466d579ee7fc6~tplv-k3u1fbpfcp-watermark.image" alt="yzb"></li></ul><h3 id="2021-Flag"><a href="#2021-Flag" class="headerlink" title="2021 Flag"></a>2021 Flag</h3><ul><li>å¤šè¯»ä¹¦ã€‚ä¹‹å‰è¶ç€äº¬ä¸œåŒåä¸€ï¼Œå›¤äº†ä¸€ç®±å­å„ç§å„æ ·çš„ä¹¦ç±ï¼Œä»Šå¹´ä¸€å®šå¤šçœ‹å‡ æœ¬</li><li>æ¯æœˆå­¦ä¹ ä¸€é—¨æœ‰æ·±åº¦/å¹²è´§çš„æŠ€æœ¯è¯¾ç¨‹</li><li>æ¯å‘¨1-2é“åŠ›æ‰£</li><li>å®Œå–„ä¸ªäººå…¬ä¼—å·å’Œ<a href="https://gongsir.club/">ä¸ªäººåšå®¢</a></li><li>æ‹’ç»æ‹–å»¶ï¼ŒåŠªåŠ›æå‡å·¥ä½œæ•ˆç‡</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ˜Ÿå…‰ä¸è´Ÿèµ¶è·¯äººï¼Œç»ˆæœ‰å¥”èµ°çº¢å°˜æ—¶ï¼Œè«å¿˜æ›¾ç»æ˜¯ä¹¦ç”Ÿï¼Œå…±å‹‰ï¼</p><h2 id="æ˜è¿›å¤„å¥³ä½œ"><a href="#æ˜è¿›å¤„å¥³ä½œ" class="headerlink" title="æ˜è¿›å¤„å¥³ä½œ"></a>æ˜è¿›å¤„å¥³ä½œ</h2><p>ç¬¬ä¸€æ¬¡åœ¨æ˜é‡‘å‘æ–‡,å¸Œæœ›èƒ½å’Œå„ä½å¤§ä½¬ä¸€èµ·å­¦ä¹ ã€è¿›æ­¥ï¼</p><h3 id="ä¸ªäººç›¸å…³é“¾æ¥"><a href="#ä¸ªäººç›¸å…³é“¾æ¥" class="headerlink" title="ä¸ªäººç›¸å…³é“¾æ¥"></a>ä¸ªäººç›¸å…³é“¾æ¥</h3><ul><li><a href="https://github.com/gongsir0630">GitHub</a></li><li><a href="https://gongsir.club/">ä¸ªäººä¸»é¡µ</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸåˆ› </category>
          
          <category> ç¨‹åºå‘˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é˜…è¯» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysqlé…ç½®è¿œç¨‹è¿æ¥å’Œä¿®æ”¹å¯†ç </title>
      <link href="/blog/2021/02/01/mysql001.html"/>
      <url>/blog/2021/02/01/mysql001.html</url>
      
        <content type="html"><![CDATA[<h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><ol><li>åŸºäºé˜¿é‡Œäº‘è½»é‡åº”ç”¨æœåŠ¡å™¨,ç³»ç»Ÿä¸ºCentOS 7;</li><li>ä½¿ç”¨å®å¡”æœåŠ¡ç®¡ç†æœåŠ¡å™¨;</li><li>åœ¨æœåŠ¡å™¨å®‰è£…mysql 5.7, æœ¬åœ°ä½¿ç”¨dgå·¥å…·è¿æ¥ç®¡ç†.</li></ol><h3 id="å®‰è£…mysqlåŠé…ç½®"><a href="#å®‰è£…mysqlåŠé…ç½®" class="headerlink" title="å®‰è£…mysqlåŠé…ç½®"></a>å®‰è£…mysqlåŠé…ç½®</h3><ul><li>ä½¿ç”¨å®å¡”å®‰è£…mysqlæœåŠ¡,åœ¨å®å¡”å•†åº—ç›´æ¥å®‰è£…å³å¯,å¯é€‰æ‹©ä¸»æµç‰ˆæœ¬:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/02/01f4tUcw.png" alt="å®å¡”å®‰è£…mysql"></li><li>åœ¨å®å¡”é¢æ¿ -&gt; å®‰å…¨ä¸­æ”¾è¡Œ3306ç«¯å£;</li><li>äº‘æœåŠ¡å™¨ä¾›åº”å•†å¤„æ”¾è¡Œ3306ç«¯å£;</li><li>åœ¨å®å¡”é¢æ¿ -&gt; æ•°æ®åº“é¡µé¢ä¿®æ”¹rootåˆå§‹å¯†ç .</li></ul><h3 id="åˆ›å»ºæ–°ç”¨æˆ·"><a href="#åˆ›å»ºæ–°ç”¨æˆ·" class="headerlink" title="åˆ›å»ºæ–°ç”¨æˆ·"></a>åˆ›å»ºæ–°ç”¨æˆ·</h3><ol><li>ç»è¿‡ä»¥ä¸Šé…ç½®,å¯ä½¿ç”¨sshè¿œç¨‹loginåˆ°æœåŠ¡å™¨,ä½¿ç”¨å‘½ä»¤è¿æ¥mysql: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure></li><li>åˆ›å»ºæ–°ç”¨æˆ·: <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span> IDENTIFIED <span class="keyword">BY</span> <span class="string">&#x27;password&#x27;</span>;</span><br></pre></td></tr></table></figure> <strong>è¯´æ˜:</strong><ul><li>username: ç”¨æˆ·å</li><li>host: æŒ‡å®šè¯¥ç”¨æˆ·åœ¨å“ªä¸ªä¸»æœºä¸Šå¯ä»¥ç™»é™†ï¼Œå¦‚æœæ˜¯æœ¬åœ°ç”¨æˆ·å¯ç”¨localhostï¼Œå¦‚æœæƒ³è®©è¯¥ç”¨æˆ·å¯ä»¥ä»ä»»æ„è¿œç¨‹ä¸»æœºç™»é™†ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦<code>%</code></li><li>passwd: è¯¥ç”¨æˆ·çš„ç™»å½•å¯†ç </li></ul></li><li>åˆ é™¤ç”¨æˆ·: <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span>;</span><br></pre></td></tr></table></figure></li></ol><h3 id="æˆæƒ"><a href="#æˆæƒ" class="headerlink" title="æˆæƒ"></a>æˆæƒ</h3><p>å¯¹æ–°åˆ›å»ºçš„ç”¨æˆ·è¿›è¡Œæˆæƒ,æˆæƒå¯ä»¥è®¿é—®ã€æ“ä½œçš„åº“,è¡¨ç­‰.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> privileges <span class="keyword">ON</span> db.tab <span class="keyword">TO</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span></span><br></pre></td></tr></table></figure><p><strong>è¯´æ˜:</strong></p><ul><li>privileges: ç”¨æˆ·çš„æ“ä½œæƒé™ï¼Œå¦‚<code>SELECT</code>ï¼Œ<code>INSERT</code>ï¼Œ<code>UPDATE</code>ç­‰ï¼Œå¦‚æœè¦æˆäºˆæ‰€çš„æƒé™åˆ™ä½¿ç”¨<code>ALL</code>;</li><li>db: æ•°æ®åº“åç§°;</li><li>tab: dbä¸‹çš„è¡¨å,å…¨åº“å…¨è¡¨å¯ç”¨<code>*.*</code>è¡¨ç¤º;</li></ul><p>åˆ·æ–°æƒé™:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush privileges;</span><br></pre></td></tr></table></figure><h3 id="è®¾ç½®ä¸ä¿®æ”¹ç”¨æˆ·å¯†ç "><a href="#è®¾ç½®ä¸ä¿®æ”¹ç”¨æˆ·å¯†ç " class="headerlink" title="è®¾ç½®ä¸ä¿®æ”¹ç”¨æˆ·å¯†ç "></a>è®¾ç½®ä¸ä¿®æ”¹ç”¨æˆ·å¯†ç </h3><ol><li>rootç”¨æˆ·å¯ä¿®æ”¹æ‰€æœ‰ç”¨æˆ·çš„å¯†ç ,å‘½ä»¤: <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PASSWORD <span class="keyword">FOR</span> <span class="string">&#x27;username&#x27;</span>@<span class="string">&#x27;host&#x27;</span> <span class="operator">=</span> PASSWORD(<span class="string">&#x27;newpassword&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li>å½“å‰ç”¨æˆ·è¯­æ³•ç³–: <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> PASSWORD <span class="operator">=</span> PASSWORD(&quot;newpassword&quot;);</span><br></pre></td></tr></table></figure></li><li>ä¿®æ”¹ç®€å•å¯†ç ä¼šæŠ¥é”™,æ­¤æ—¶å¯ä»¥ä¿®æ”¹å¯†ç ç­–ç•¥:<ul><li>æŸ¥çœ‹å¯†ç ç­–ç•¥:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%validate%&#x27;</span>;</span><br></pre></td></tr></table></figure><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/02/01AWXivL.png" alt="å¯†ç ç­–ç•¥"></li><li>ä¿®æ”¹ç­–ç•¥:<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password_length<span class="operator">=</span><span class="number">6</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">global</span> validate_password_policy<span class="operator">=</span><span class="number">0</span>;</span><br></pre></td></tr></table></figure></li></ul></li><li>ä¿®æ”¹è®¿é—®ä¸»æœº: <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">use mysql;</span><br><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host<span class="operator">=</span><span class="string">&#x27;host&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span><span class="operator">=</span><span class="string">&#x27;username&#x27;</span>;</span><br></pre></td></tr></table></figure> <strong>è¯´æ˜:</strong><ul><li>host: å…è®¸çš„ä¸»æœºip,ä¿®æ”¹ä¸º<code>%</code>å¯å…è®¸æ‰€æœ‰ä¸»æœºè®¿é—®.</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> åŸåˆ› </category>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3ï¸âƒ£MyBlog-Hexoé¡¹ç›®æŒç»­é›†æˆå‘å¸ƒ</title>
      <link href="/blog/2021/01/22/myblog-deploy.html"/>
      <url>/blog/2021/01/22/myblog-deploy.html</url>
      
        <content type="html"><![CDATA[<p>å¾ˆä¹…æ²¡æ›´äº†,è¿™æ®µæ—¶é—´å¼€å§‹åšæ¯•è®¾äº†,æ‰€ä»¥æ›´æ–°æ…¢äº†,è§è°…! è¿™æ˜¯ <strong>MyBlog</strong> ç³»åˆ—æ–‡ç« ç¬¬ä¸‰ç¯‡ï¼Œä¸Šæ–‡è®²äº†å¦‚ä½•å°†hexoé¡¹ç›®è¿›è¡Œè¿œç¨‹æ‰˜ç®¡.æœ¬æ–‡è¯´ä¸€ä¸‹æ€ä¹ˆä½¿ç”¨Codingå¹³å°çš„æŒç»­é›†æˆå¯¹æˆ‘ä»¬çš„Hexoé¡¹ç›®è¿›è¡Œè‡ªåŠ¨éƒ¨ç½².</p><a id="more"></a><h2 id="ç³»åˆ—-ğŸ“’"><a href="#ç³»åˆ—-ğŸ“’" class="headerlink" title="ç³»åˆ— ğŸ“’"></a>ç³»åˆ— ğŸ“’</h2><p>æˆ‘çš„åšå®¢(<a href="https://blog.gongsir.club/">ç¨‹åºå‘˜Kyleâœ¨|æŠ€æœ¯åšå®¢</a>)æ˜¯åŸºäºHexoæ­å»ºçš„, ä»£ç æ‰˜ç®¡åœ¨GitHubå’ŒCoding, éƒ¨ç½²åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨, å…¶ä¸­éƒ¨ç½²æ˜¯åŸºäºCodingæä¾›çš„æŒç»­é›†æˆ.</p><h3 id="å‘å¸ƒåšå®¢"><a href="#å‘å¸ƒåšå®¢" class="headerlink" title="å‘å¸ƒåšå®¢"></a>å‘å¸ƒåšå®¢</h3><p>åœ¨æœ¬åœ°ç¼–å†™ Markdown æ–‡ä»¶, ç„¶åå°†ä»£ç pushåˆ°æ‰˜ç®¡å¹³å°, å³å¯è‡ªåŠ¨è§¦å‘æŒç»­é›†æˆ, å°†ç½‘é¡µéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨, å…¨è‡ªåŠ¨~</p><h3 id="ç³»åˆ—æ–‡ç« ç›®å½•"><a href="#ç³»åˆ—æ–‡ç« ç›®å½•" class="headerlink" title="ç³»åˆ—æ–‡ç« ç›®å½•"></a>ç³»åˆ—æ–‡ç« ç›®å½•</h3><ol><li><a href="/2020/12/14/MyBlog-Hexo/">MyBlog-Hexoæ­å»ºè‡ªå·±çš„åšå®¢</a></li><li><a href="/2020/12/20/myblog-code.html">MyBlog-å¤šå¹³å°ä»£ç æ‰˜ç®¡</a></li><li><a href="/2021/01/22/myblog-deploy.html">MyBlog-Hexoé¡¹ç›®æŒç»­é›†æˆå‘å¸ƒ</a><hr></li></ol><h2 id="Itâ€™s-Show-Time-ğŸŒŸ"><a href="#Itâ€™s-Show-Time-ğŸŒŸ" class="headerlink" title="Itâ€™s Show~Time ğŸŒŸ"></a>Itâ€™s Show~Time ğŸŒŸ</h2><ol><li><p>æ³¨å†ŒCodingå›¢é˜Ÿ,è¿›å…¥å·¥ä½œå°,åˆ›å»ºé¡¹ç›®:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/01/22UIPJbh.png" alt="22UIPJbh"></p></li><li><p>åˆ›å»ºDevOpsæ¨¡æ¿é¡¹ç›®,å¡«å†™è‡ªå®šä¹‰ä¿¡æ¯:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/01/22XkYjq6.png" alt="22XkYjq6"></p></li><li><p>è¿›å…¥é¡¹ç›®å,ç•Œé¢å¦‚ä¸‹:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/01/22Av92HB.png" alt="22Av92HB"></p></li><li><p>ä»£ç ä»“åº“å¯ä»¥æ‰˜ç®¡æˆ‘ä»¬çš„Hexoé¡¹ç›®,å¯ä»¥ç›´æ¥ä»GitHubå…‹éš†è¿‡æ¥,å¹¶ä¸”æä¾›äº†å®šæ—¶æ›´æ–°;ä¹Ÿå¯ä»¥åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒç›´æ¥æäº¤åˆ°è¿™é‡Œ:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/01/22EcRyhE.png" alt="22EcRyhE"></p></li><li><p>é€‰æ‹©<code>æŒç»­é›†æˆ</code>,æ–°å»ºæ„å»ºè®¡åˆ’,é…ç½®ä»“åº“ä¿¡æ¯,é€‰æ‹©hexoé¡¹ç›®çš„æ‰˜ç®¡å¹³å°,æˆ‘çš„æ˜¯Coding,é€‰æ‹©é™æ€é…ç½®Jenkinsfile:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/01/22RpeXuR.png" alt="22RpeXuR"></p></li><li><p>ç¼–å†™Jenkinsfile:</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">pipeline &#123;</span><br><span class="line">agent any</span><br><span class="line">stages &#123;</span><br><span class="line">    stage(<span class="string">&#x27;æ£€å‡º&#x27;</span>) &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        checkout([</span><br><span class="line">        <span class="variable">$class</span>: <span class="string">&#x27;GitSCM&#x27;</span>, branches: [[name: env.GIT_BUILD_REF]],</span><br><span class="line">        userRemoteConfigs: [[</span><br><span class="line">            url: env.GIT_REPO_URL,</span><br><span class="line">            credentialsId: env.CREDENTIALS_ID</span><br><span class="line">        ]]</span><br><span class="line">        ])</span><br><span class="line">        sh <span class="string">&#x27;ls -la&#x27;</span></span><br><span class="line">        sh <span class="string">&#x27;git submodule init&#x27;</span></span><br><span class="line">        sh <span class="string">&#x27;git submodule update&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;æ„å»º&#x27;</span>) &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;æ„å»ºä¸­...&#x27;</span></span><br><span class="line">        sh <span class="string">&#x27;&#x27;</span><span class="string">&#x27;pwd</span></span><br><span class="line"><span class="string">            node -v</span></span><br><span class="line"><span class="string">            npm install -g hexo-cli</span></span><br><span class="line"><span class="string">            npm install&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">                    npmAuditInDir(directory: <span class="string">&#x27;/&#x27;</span>, collectResult: <span class="literal">true</span>)</span><br><span class="line">                    sh <span class="string">&#x27;&#x27;</span><span class="string">&#x27;pwd</span></span><br><span class="line"><span class="string">            hexo clean</span></span><br><span class="line"><span class="string">            hexo generate&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">        sh <span class="string">&#x27;tar -zcf /tmp/tmp.tar.gz public/&#x27;</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;æ„å»ºå®Œæˆ.&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;æµ‹è¯•&#x27;</span>) &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        sh <span class="string">&#x27;&#x27;</span><span class="string">&#x27;ls -lh public/</span></span><br><span class="line"><span class="string">                if [ ! -s public/index.html ]</span></span><br><span class="line"><span class="string">                then</span></span><br><span class="line"><span class="string">                exit 1</span></span><br><span class="line"><span class="string">                fi&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    stage(<span class="string">&#x27;éƒ¨ç½²&#x27;</span>) &#123;</span><br><span class="line">    steps &#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;éƒ¨ç½²ä¸­...&#x27;</span></span><br><span class="line">        script &#123;</span><br><span class="line">        def remote = [:]</span><br><span class="line">        remote.name = <span class="string">&#x27;aliyun-server&#x27;</span></span><br><span class="line">        remote.allowAnyHosts = <span class="literal">true</span></span><br><span class="line">        remote.host = <span class="string">&#x27;gongsir.club&#x27;</span></span><br><span class="line">        remote.port = 22</span><br><span class="line">        remote.user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line"></span><br><span class="line">        // æŠŠã€ŒCODING å‡­æ®ç®¡ç†ã€ä¸­çš„ã€Œå‡­æ® IDã€å¡«å…¥ credentialsIdï¼Œè€Œ username å’Œ password æ— éœ€ä¿®æ”¹</span><br><span class="line">        withCredentials([usernamePassword(credentialsId: <span class="string">&quot;1f981c07-2c51-4a64-a93b-be09ba76a406&quot;</span>, usernameVariable: <span class="string">&#x27;username&#x27;</span>, passwordVariable: <span class="string">&#x27;password&#x27;</span>)]) &#123;</span><br><span class="line">            remote.user = username</span><br><span class="line">            remote.password = password</span><br><span class="line"></span><br><span class="line">            // SSH ä¸Šä¼ æ–‡ä»¶åˆ°è¿œç«¯æœåŠ¡å™¨</span><br><span class="line">            sshPut remote: remote, from: <span class="string">&#x27;/tmp/tmp.tar.gz&#x27;</span>, into: <span class="string">&#x27;/tmp/&#x27;</span></span><br><span class="line">            // è§£å‹ç¼©</span><br><span class="line">            sshCommand remote: remote, <span class="built_in">command</span>: <span class="string">&quot;tar -zxf /tmp/tmp.tar.gz -C /tmp/&quot;</span></span><br><span class="line">            sshCommand remote: remote, sudo: <span class="literal">true</span>, <span class="built_in">command</span>: <span class="string">&quot;mkdir -p /www/wwwroot/blog.gongsir.club&quot;</span></span><br><span class="line">            sshCommand remote: remote, sudo: <span class="literal">true</span>, <span class="built_in">command</span>: <span class="string">&quot;cp -R /tmp/public/* /www/wwwroot/blog.gongsir.club/&quot;</span></span><br><span class="line">            // é‡å¯ nginx</span><br><span class="line">            sshCommand remote: remote, sudo: <span class="literal">true</span>, <span class="built_in">command</span>: <span class="string">&quot;nginx -s reload&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">&#x27;éƒ¨ç½²å®Œæˆ&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> ã€ŒCODING å‡­æ®ç®¡ç†ã€ä¸­çš„ã€Œå‡­æ® IDã€:<br> <img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/03/19fDIDPk.png" alt="å‡­æ®IDè®¾ç½®"></p></li><li><p>è®¾ç½®è§¦å‘è§„åˆ™,è®¾ç½®ä»£ç æ›´æ–°åˆ°åˆ¶å®šåˆ†æ”¯æ—¶è‡ªåŠ¨è§¦å‘:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/01/22TkLg3F.png" alt="22TkLg3F"></p></li><li><p>æœåŠ¡å™¨ä½¿ç”¨<code>NGINX</code>éƒ¨ç½²é™æ€æ–‡ä»¶å¤¹å³å¯:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/image/2021/01/22fpDGmY.png" alt="22fpDGmY"></p></li><li><p>çœ‹æˆæœ:<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/gif/myblog-deploy-show.gif" alt="è‡ªåŠ¨éƒ¨ç½²å±•ç¤º"></p></li></ol><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ul><li><a href="https://help.coding.net/docs/ci/start.html">å¿«é€Ÿå¼€å§‹æŒç»­é›†æˆ</a></li><li><a href="https://help.coding.net/docs/ci/deploy/ssh.html">è‡ªåŠ¨éƒ¨ç½²åˆ°LinuxæœåŠ¡å™¨</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸåˆ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> MyBlog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2ï¸âƒ£MyBlog-å¤šå¹³å°ä»£ç æ‰˜ç®¡</title>
      <link href="/blog/2020/12/20/myblog-code.html"/>
      <url>/blog/2020/12/20/myblog-code.html</url>
      
        <content type="html"><![CDATA[<p><strong>MyBlog</strong> ç³»åˆ—æ–‡ç« ç¬¬äºŒç¯‡ï¼Œä¸Šç¯‡æ–‡ç« è¯´äº†å¦‚ä½•ä½¿ç”¨<a href="https://hexo.io/zh-cn/">Hexo</a>æ­å»ºè‡ªå·±çš„ä¸“å±åšå®¢ï¼Œä½†è‡ªå·±æœ‰ä¸¤å°Macï¼Œæƒ³åœ¨ä¸åŒè®¾å¤‡éƒ½å¯ä»¥å‘å¸ƒåšå®¢ï¼Œä¸ºäº†æ–¹ä¾¿è¿›è¡Œåšå®¢è¿ç§»ï¼Œæ‰€ä»¥é‡‡ç”¨ä»£ç æ‰˜ç®¡å¹³å°æ¥å­˜å‚¨æˆ‘çš„hexoé¡¹ç›®æ–‡ä»¶ï¼Œè¿™é‡Œé‡‡ç”¨å›½å¤–çš„<a href="https://github.com/">GitHub</a>å’Œå›½å†…çš„<a href="https://e.coding.net/">Coding</a>.</p><a id="more"></a><h2 id="ç³»åˆ—-ğŸ“’"><a href="#ç³»åˆ—-ğŸ“’" class="headerlink" title="ç³»åˆ— ğŸ“’"></a>ç³»åˆ— ğŸ“’</h2><p>æˆ‘çš„åšå®¢(<a href="https://blog.gongsir.club/">ç¨‹åºå‘˜Kyleâœ¨|æŠ€æœ¯åšå®¢</a>)æ˜¯åŸºäºHexoæ­å»ºçš„, ä»£ç æ‰˜ç®¡åœ¨GitHubå’ŒCoding, éƒ¨ç½²åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨, å…¶ä¸­éƒ¨ç½²æ˜¯åŸºäºCodingæä¾›çš„æŒç»­é›†æˆ.</p><h3 id="å‘å¸ƒåšå®¢"><a href="#å‘å¸ƒåšå®¢" class="headerlink" title="å‘å¸ƒåšå®¢"></a>å‘å¸ƒåšå®¢</h3><p>åœ¨æœ¬åœ°ç¼–å†™ Markdown æ–‡ä»¶, ç„¶åå°†ä»£ç pushåˆ°æ‰˜ç®¡å¹³å°, å³å¯è‡ªåŠ¨è§¦å‘æŒç»­é›†æˆ, å°†ç½‘é¡µéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨, å…¨è‡ªåŠ¨~</p><h3 id="ç³»åˆ—æ–‡ç« ç›®å½•"><a href="#ç³»åˆ—æ–‡ç« ç›®å½•" class="headerlink" title="ç³»åˆ—æ–‡ç« ç›®å½•"></a>ç³»åˆ—æ–‡ç« ç›®å½•</h3><ol><li><a href="/2020/12/14/MyBlog-Hexo/">MyBlog-Hexoæ­å»ºè‡ªå·±çš„åšå®¢</a></li><li><a href="/2020/12/20/myblog-code.html">MyBlog-å¤šå¹³å°ä»£ç æ‰˜ç®¡</a></li><li><a href="/2021/01/22/myblog-deploy.html">MyBlog-Hexoé¡¹ç›®æŒç»­é›†æˆå‘å¸ƒ</a><hr></li></ol><h2 id="é¡¹ç›®æ‰˜ç®¡"><a href="#é¡¹ç›®æ‰˜ç®¡" class="headerlink" title="é¡¹ç›®æ‰˜ç®¡"></a>é¡¹ç›®æ‰˜ç®¡</h2><p>åšå®¢è¿ç§»æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™ä»¥ä¸‹æ–‡ä»¶ï¼š</p><ul><li>scaffolds/    â€“&gt; æ¨¡æ¿</li><li>source/   â€“&gt; èµ„æºæ–‡ä»¶å’Œmd</li><li>themes/   â€“&gt; ä¸»é¢˜æ–‡ä»¶</li><li>_config.yml   â€“&gt; é…ç½®æ–‡ä»¶</li><li>package.json  â€“&gt; ä¾èµ–æ–‡ä»¶</li><li>package-lock.json â€“&gt; æ’ä»¶ç‰ˆæœ¬</li><li><strong>ğŸŒŸæ³¨æ„ï¼š<code>public/</code>ç›®å½•å†…å®¹å¯ä»¥é€šè¿‡hexoç”Ÿæˆï¼Œæ‰€ä»¥ä¸éœ€è¦backup</strong></li></ul><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å°†ä¸Šè¿°æ–‡ä»¶æ‰˜ç®¡åœ¨GitHubã€Codingç­‰å¹³å°å°±å¯ä»¥ï¼Œä»¥åä½¿ç”¨çš„æ—¶å€™ï¼Œåªéœ€è¦æœ¬åœ°å®‰è£…nodeç¯å¢ƒï¼Œç„¶åæ‹‰å–åˆ†æ”¯ï¼Œæ‰§è¡Œï¼š</p><ol><li>å®‰è£…hexo-cliï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure></li><li>å®‰è£…npmä¾èµ–ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure></li><li>è§£æç”Ÿæˆé™æ€æ–‡ä»¶ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure></li></ol><h3 id="Githubæ‰˜ç®¡"><a href="#Githubæ‰˜ç®¡" class="headerlink" title="Githubæ‰˜ç®¡"></a>Githubæ‰˜ç®¡</h3><ol><li>ç™»å½•GitHubï¼Œæ–°å»ºrepositoryï¼Œå¤åˆ¶ä»“åº“åœ°å€<code>@your_url</code>ï¼›</li><li>æœ¬åœ°ä»£ç æ–‡ä»¶å¤¹<code>(blog.gongsir.club)</code>åˆå§‹åŒ–ï¼Œè®¾ç½®è¿œç¨‹ä»“åº“åœ°å€ï¼š<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin @your_url</span><br></pre></td></tr></table></figure>ğŸŒŸæ³¨æ„ï¼šè¿™é‡Œéœ€è¦å°†<code>themes/blank</code>åŠ ä¸ºå­æ¨¡å—ï¼ˆç¬¬ä¸€ç¯‡æ–‡ç« ä¸­æè¿‡ï¼Œæ–¹ä¾¿ä¸»é¢˜å‡çº§ï¼‰ï¼Œæ­¤æ—¶é¡¹ç›®æ ¹ç›®å½•ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<code>.gitmodules</code>æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦ä¸Šä¼ åˆ°è¿œç¨‹ä»“åº“ï¼š<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add https://github.com/a2396837/hexo-theme-blank.git themes/blank</span><br></pre></td></tr></table></figure></li><li>å°†æœ¬åœ°ä»£ç pushä¸Šå»ï¼Œæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/img/20201221224358.png" alt="GitHubä»£ç æ‰˜ç®¡"></li></ol><h3 id="Codingæ‰˜ç®¡"><a href="#Codingæ‰˜ç®¡" class="headerlink" title="Codingæ‰˜ç®¡"></a>Codingæ‰˜ç®¡</h3><p>ä¸€å¼€å§‹æˆ‘ä»£ç ç›´æ¥æ‰˜ç®¡åœ¨GitHubä¸Šçš„ï¼Œåšå®¢éƒ¨ç½²æ˜¯åŸºäº<code>Git Actions</code>ç”Ÿæˆ<code>public/</code>å†…å®¹ï¼Œå°†<code>public/</code>ä¸Šä¼ åˆ°å¦ä¸€ä¸ªåˆ†æ”¯<code>page</code>ï¼Œç„¶ååœ¨è‡ªå·±çš„æœåŠ¡å™¨æ‹‰å–<code>page</code>åˆ†æ”¯ä»¥éƒ¨ç½²ç½‘ç«™.</p><p>è¿™ç§æ–¹å¼æœ‰ä¸€äº›å°é—®é¢˜ï¼š</p><ul><li>GitHubå›½å†…è®¿é—®é€Ÿåº¦æ„Ÿäºº</li><li><code>.config.yml</code>éœ€è¦é…ç½®<a href="https://github.com/hexojs/hexo-deployer-git">hexo-deploy</a></li><li>æ¯æ¬¡åšå®¢æ›´æ–°éƒ½éœ€è¦æ‰‹åŠ¨éƒ¨ç½²</li><li>ç»¼ä¸Šï¼Œä¸ªäººè§‰å¾—è¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦</li></ul><p>æ‰€ä»¥åæ¥é‡‡ç”¨äº†å›½å†…Codingè¿›è¡Œæ‰˜ç®¡ï¼Œå¹¶åŸºäºCodingçš„æŒç»­é›†æˆå¯¹åšå®¢è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½².</p><ol><li>ä¹‹å‰å·²ç»å°†ä»£ç æ‰˜ç®¡åœ¨GitHubçš„ï¼Œå¯ä»¥ç›´æ¥åœ¨Codingä¸Šå…‹éš†GitHubçš„ä»“åº“ï¼š<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/img/20201222120853.png" alt="Coding"></li><li>ä¿®æ”¹æœ¬åœ°gitçš„configï¼Œå°†codingçš„urlåŠ å…¥gité…ç½®ï¼š<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote set-url -add origin https://e.coding.net/xxx.git</span><br></pre></td></tr></table></figure>æŸ¥çœ‹remoteä¿¡æ¯ï¼Œæ­¤æ—¶åº”è¯¥åŒ…å«ä¸¤ä¸ªpushä»“åº“ï¼Œä»¥åoushä»£ç çš„æ—¶å€™ï¼Œä¼šåŒæ—¶pushåˆ°githubå’Œcodingï¼š<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/img/20201222121345.png" alt="remote"></li></ol><h2 id="ssh-keyç®¡ç†"><a href="#ssh-keyç®¡ç†" class="headerlink" title="ssh-keyç®¡ç†"></a>ssh-keyç®¡ç†</h2><ol><li><p>ä¸ºäº†æ–¹ä¾¿æ¯æ¬¡pushä»£ç æ—¶é¿å…è¾“å…¥å¯†ç ï¼Œéœ€è¦åœ¨è‡ªå·±æœ¬åœ°é…ç½®ssh-keyï¼Œgithubå’Œcodingå®˜æ–¹éƒ½æœ‰æ•™ç¨‹ï¼š</p><ul><li><a href="https://docs.github.com/articles/generating-an-ssh-key/">generating SSH keys</a></li><li><a href="https://help.coding.net/docs/project-settings/features/ssh.html">é…ç½®SSHå…¬é’¥</a></li></ul></li><li><p>æœ¬åœ°å¤šå¹³å°å…¬é’¥ç®¡ç†ï¼Œå½“æœ¬åœ°å­˜åœ¨å¤šä¸ªå¹³å°çš„public-keyæ—¶ï¼Œéœ€è¦æ·»åŠ configé…ç½®æ–‡ä»¶ï¼Œå¦åˆ™æŸäº›å¹³å°å…¬é’¥ä¸ä¼šç”Ÿæ•ˆï¼š</p></li></ol><ul><li>åœ¨<code>.ssh/</code>ç›®å½•ä¸‹æ–°å»ºconfigæ–‡ä»¶ï¼Œé…ç½®ä¸åŒå¹³å°çš„sshå…¬é’¥ï¼š<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/img/20201222122841.png" alt=".sshç›®å½•"><br>configæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># github</span></span><br><span class="line">Host github.com</span><br><span class="line">HostName github.com</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line"><span class="comment"># è¿™é‡Œè®¾ç½®githubçš„å…¬é’¥æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">IdentityFile C:\Users\gongsir\.ssh\id_ed25519</span><br><span class="line"></span><br><span class="line"><span class="comment"># coding</span></span><br><span class="line">Host e.coding.net</span><br><span class="line">HostName e.coding.net</span><br><span class="line">PreferredAuthentications publickey</span><br><span class="line"><span class="comment"># è¿™é‡Œè®¾ç½®codingçš„å…¬é’¥æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">IdentityFile C:\Users\gongsir\.ssh\id_rsa</span><br></pre></td></tr></table></figure></li><li>ä½¿ç”¨<code>ssh -T git@github.com</code>ã€<code>ssh -T git@e.coding.net</code>éªŒè¯ï¼š<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/img/20201222123241.png" alt="sshéªŒè¯"></li></ul>]]></content>
      
      
      <categories>
          
          <category> åŸåˆ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> MyBlog </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1ï¸âƒ£MyBlog-Hexoæ­å»ºè‡ªå·±çš„åšå®¢</title>
      <link href="/blog/2020/12/14/MyBlog-Hexo.html"/>
      <url>/blog/2020/12/14/MyBlog-Hexo.html</url>
      
        <content type="html"><![CDATA[<p><strong>MyBlog</strong> ç³»åˆ—æ–‡ç« ä¹‹ä¸€, è¿™ç¯‡æ–‡ç« , ä»‹ç»å¦‚ä½•ä½¿ç”¨<a href="https://hexo.io/zh-cn/">Hexo</a>æ­å»ºåšå®¢ç¯å¢ƒ, ä»¥åŠHexoçš„åŸºæœ¬ç”¨æ³•.</p><a id="more"></a><h2 id="ç³»åˆ—-ğŸ“’"><a href="#ç³»åˆ—-ğŸ“’" class="headerlink" title="ç³»åˆ— ğŸ“’"></a>ç³»åˆ— ğŸ“’</h2><p>æˆ‘çš„åšå®¢(<a href="https://blog.gongsir.club/">ç¨‹åºå‘˜Kyleâœ¨|æŠ€æœ¯åšå®¢</a>)æ˜¯åŸºäºHexoæ­å»ºçš„, ä»£ç æ‰˜ç®¡åœ¨GitHubå’ŒCoding, éƒ¨ç½²åœ¨é˜¿é‡Œäº‘æœåŠ¡å™¨, å…¶ä¸­éƒ¨ç½²æ˜¯åŸºäºCodingæä¾›çš„æŒç»­é›†æˆ.</p><h3 id="å‘å¸ƒåšå®¢"><a href="#å‘å¸ƒåšå®¢" class="headerlink" title="å‘å¸ƒåšå®¢"></a>å‘å¸ƒåšå®¢</h3><p>åœ¨æœ¬åœ°ç¼–å†™ Markdown æ–‡ä»¶, ç„¶åå°†ä»£ç pushåˆ°æ‰˜ç®¡å¹³å°, å³å¯è‡ªåŠ¨è§¦å‘æŒç»­é›†æˆ, å°†ç½‘é¡µéƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨, å…¨è‡ªåŠ¨~</p><h3 id="ç³»åˆ—æ–‡ç« ç›®å½•"><a href="#ç³»åˆ—æ–‡ç« ç›®å½•" class="headerlink" title="ç³»åˆ—æ–‡ç« ç›®å½•"></a>ç³»åˆ—æ–‡ç« ç›®å½•</h3><ol><li><a href="/2020/12/14/MyBlog-Hexo/">MyBlog-Hexoæ­å»ºè‡ªå·±çš„åšå®¢</a></li><li><a href="/2020/12/20/myblog-code.html">MyBlog-å¤šå¹³å°ä»£ç æ‰˜ç®¡</a></li><li><a href="/2021/01/22/myblog-deploy.html">MyBlog-Hexoé¡¹ç›®æŒç»­é›†æˆå‘å¸ƒ</a><hr></li></ol><h2 id="å…³äºHexo"><a href="#å…³äºHexo" class="headerlink" title="å…³äºHexo"></a>å…³äºHexo</h2><p>Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ <a href="https://daringfireball.net/projects/markdown/">Markdown</a>ï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚<br>Hexoå®˜ç½‘: <a href="https://hexo.io/zh-cn/">Hexo</a><br></p><h2 id="å®‰è£…Git-Node"><a href="#å®‰è£…Git-Node" class="headerlink" title="å®‰è£…Git | Node"></a>å®‰è£…Git | Node</h2><ol><li>æœ¬åœ°ç¯å¢ƒ: æˆ‘ç”¨çš„æ˜¯Mac, ä»¥ä¸‹æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸºäº MacOS ç³»ç»Ÿ, å…³äºå…¶ä»–å¹³å°è½¯ä»¶å®‰è£…, å¤§åŒå°å¼‚.<br></li><li>å®‰è£… Hexo ç›¸å½“ç®€å•ï¼Œåªéœ€è¦å…ˆå®‰è£…ä¸‹åˆ—åº”ç”¨ç¨‹åºå³å¯:<ul><li><a href="http://nodejs.org/">Node.js</a> (Node.js ç‰ˆæœ¬éœ€ä¸ä½äº 10.13ï¼Œå»ºè®®ä½¿ç”¨ Node.js 12.0 åŠä»¥ä¸Šç‰ˆæœ¬)</li><li><a href="http://git-scm.com/">Git</a></li></ul></li><li>MacOSä½¿ç”¨ brew|brewcask å®‰è£…éå¸¸ç®€å•, è¿™é‡Œä¸åšèµ˜è¿°, å…¶ä»–ç³»ç»Ÿä¹Ÿå¯å»æŸåº¦æœç´¢, å®‰è£…å¾ˆeasyçš„~<br></li></ol><h2 id="å®‰è£…Hexo"><a href="#å®‰è£…Hexo" class="headerlink" title="å®‰è£…Hexo"></a>å®‰è£…Hexo</h2><ol><li>æ‰“å¼€ç»ˆç«¯, åˆ›å»ºä¸ªäººåšå®¢å­˜æ”¾ç›®å½•(eg: blog.gongsir.club):  <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> blog.gongsir.club</span><br></pre></td></tr></table></figure> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> blog.gongsir.club</span><br></pre></td></tr></table></figure></li><li>ç»ˆç«¯æ‰§è¡Œ Hexo å®‰è£…å‘½ä»¤: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure></li><li>ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹hexoä¿¡æ¯ï¼ŒæˆåŠŸå³å¯ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo -v</span><br></pre></td></tr></table></figure></li></ol><h2 id="å¼€å§‹-âœ¨"><a href="#å¼€å§‹-âœ¨" class="headerlink" title="å¼€å§‹ âœ¨"></a>å¼€å§‹ âœ¨</h2><h3 id="åŸºç¡€ç¯å¢ƒ"><a href="#åŸºç¡€ç¯å¢ƒ" class="headerlink" title="åŸºç¡€ç¯å¢ƒ"></a>åŸºç¡€ç¯å¢ƒ</h3><p>æ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹ä½¿ç”¨hexoæ­å»ºä¸€ä¸ª â€œHello Worldâ€ é¡µé¢äº†ã€‚</p><ol><li>ä½¿ç”¨hexoçš„hello-worldåˆå§‹åŒ–ä½ çš„åšå®¢ï¼ˆæ­¤æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨Gitå…‹éš†é¡¹ç›®ï¼‰ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure></li><li>å®‰è£…hexoæ‰€éœ€ä¾èµ–ï¼š <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br></pre></td></tr></table></figure></li><li>å¯åŠ¨ï¼Œé¢„è§ˆï¼š<a href="http://localhost:4000/">http://localhost:4000</a> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure></li></ol><p>æˆåŠŸçœ‹åˆ°Hexoçš„Helloâ€”â€”Worldé¡µé¢å³è¡¨ç¤ºHexoå»ºç«™æˆåŠŸï¼Œä½†æ˜¯ä¼¼ä¹UIä¸å¤ªå–œæ¬¢ï¼Œæƒ³æ”¹ä¸‹ä¸»é¢˜ï¼Œæ‰€ä»¥åç»­æ¥äº†ï¼ï¼ï¼</p><h3 id="ä¸»é¢˜é…ç½®"><a href="#ä¸»é¢˜é…ç½®" class="headerlink" title="ä¸»é¢˜é…ç½®"></a>ä¸»é¢˜é…ç½®</h3><ol><li><p>æˆ‘å°è¯•è¿‡å¾ˆå¤šä¸»é¢˜ï¼Œåœ¨hexoçš„ä¸»é¢˜å®˜ç½‘æœ‰å¾ˆå¤šthemesï¼Œä½†æ˜¯æ„Ÿè§‰éƒ½ä¸æ˜¯æˆ‘æƒ³è¦çš„ï¼Œæœ€ååœ¨githubä¸Šå‘ç°äº†ä¸€æ¬¾ä¸é”™çš„ä¸»é¢˜â€”â€”<a href="https://github.com/a2396837/hexo-theme-blank">hexo-theme-blank</a></p><ul><li>GitHub: <a href="https://github.com/a2396837/hexo-theme-blank">https://github.com/a2396837/hexo-theme-blank</a></li><li>Themeé…ç½®æ–‡æ¡£ï¼ˆå¾ˆè¯¦ç»†ï¼‰ï¼š <a href="https://dmx.pub/">https://dmx.pub/</a></li></ul></li><li><p>ä¸»é¢˜å®‰è£…è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œå‡è®¾æˆ‘ä»¬å¸Œæœ›å°†æ•´ä¸ªåšå®¢æ–‡ä»¶æ”¾åœ¨Githubè¿›è¡Œæ‰˜ç®¡ï¼Œè€Œæˆ‘ä»¬å®‰è£…ä¸»é¢˜æ—¶é€šå¸¸æ˜¯ç›´æ¥åœ¨themesæ–‡ä»¶å¤¹ä¸‹å…‹éš†ä¸»é¢˜ä»“åº“ï¼š</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/a2396837/hexo-theme-blank.git blank</span><br></pre></td></tr></table></figure><p> å½“æˆ‘ä»¬ä¿®æ”¹äº†æˆ‘ä»¬çš„åšå®¢å†…å®¹ï¼Œå‘githubæäº¤ä»£ç çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°å†²çªï¼Œå› ä¸ºæˆ‘ä»¬çš„themes/blankåŒ…å«åœ¨åšå®¢ç›®å½•ä¸‹ï¼ˆå³gitå·¥ç¨‹åŒ…å«äº†gitå·¥ç¨‹ï¼‰ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å°†themes/blankä¸‹çš„<code>.git</code>æ–‡ä»¶å¤¹åˆ é™¤ï¼Œæ­¤æ—¶themes/blankå°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶å¤¹ï¼Œåšå®¢é¡¹ç›®å°±å¯ä»¥ç›´æ¥pushåˆ°githubã€‚</p><p> ä½†æ˜¯æˆ‘ä»¬è€ƒè™‘åˆ°ä¸»é¢˜åœ¨ä»Šåå¯èƒ½ä¼šæœ‰å‡çº§çš„æƒ…å†µï¼Œä¸»é¢˜ç›®å½•ä½¿ç”¨<code>git pull</code>å³å¯å®Œæˆå‡çº§ï¼Œå› æ­¤å°±ä¸èƒ½åˆ é™¤ä¸»é¢˜ç›®å½•çš„<code>.git</code>ï¼Œå»ºè®®ä½¿ç”¨<strong>Gitå­æ¨¡å—</strong>å¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œä»£ç æ‰˜ç®¡ï¼š<br> åœ¨åšå®¢æ ¹ç›®å½•æ‰§è¡Œï¼š</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## ä¸‹è½½ä¸»é¢˜</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/a2396837/hexo-theme-blank.git themes/blank</span><br><span class="line"><span class="comment">## å°†ä¸»é¢˜æ–‡ä»¶å¤¹æ·»åŠ ä¸ºgitå­æ¨¡å—</span></span><br><span class="line">git submodule add https://github.com/a2396837/hexo-theme-blank.git themes/blank</span><br></pre></td></tr></table></figure><p> ä¹‹åæˆ‘ä»¬çš„åšå®¢æ ¹ç›®å½•å°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<code>.gitmodules</code>çš„æ–‡ä»¶ï¼Œè®°å½•äº†å­æ¨¡å—çš„ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ­£å¸¸æ“ä½œçˆ¶é¡¹ç›®å°±å¯ä»¥äº†ï¼Œæƒ³å­¦ä¹ æ›´å¤šå…³äº<code>gitå­æ¨¡å—</code>çš„çŸ¥è¯†ï¼Œå¯ä»¥å»å®˜ç½‘å­¦å­¦~</p></li><li><p>ä¸ºäº†ä¸»é¢˜åœ¨ä»Šåèƒ½å¤Ÿè¿›è¡Œå¹³æ»‘å‡çº§ï¼Œæˆ‘ä»¬ä¸è¦åœ¨ä¸»é¢˜æ–‡ä»¶å¤¹ç›´æ¥ä¿®æ”¹é…ç½®ï¼Œè§£å†³æ–¹æ³•æ˜¯å°†ä¸»é¢˜ä¸­çš„<code>._config.yml</code>æ‹·è´åˆ°åšå®¢æ ¹ç›®å½•çš„<code>source/_data</code>ï¼ˆéœ€è¦è‡ªå·±æ–°å»º<code>_data</code>ï¼‰ç›®å½•ä¸‹ï¼Œå¹¶é‡å‘½åä¸º<code>blank.yml</code>ï¼Œç„¶ååœ¨<code>blank.yml</code>è¿›è¡Œä¸»é¢˜é…ç½®:</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> <span class="built_in">source</span>/_data</span><br><span class="line"><span class="built_in">cp</span> -p themes/blank/_config.yml <span class="built_in">source</span>/_data/blank.yml</span><br></pre></td></tr></table></figure><h3 id="å¼€å§‹åˆ›ä½œ"><a href="#å¼€å§‹åˆ›ä½œ" class="headerlink" title="å¼€å§‹åˆ›ä½œ"></a>å¼€å§‹åˆ›ä½œ</h3></li><li><p>hexoå¯ä»¥ç›´æ¥è§£æmdæ–‡æ¡£ï¼Œæˆ‘ä»¬åªéœ€æ–°å»ºä¸€ä¸ªmdï¼Œç„¶åç¼–è¾‘mdå³å¯ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">&quot;blog-title&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>ä»¥ä¸Šä¼šåœ¨<code>source/_post</code>ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåå«â€œblog-titleâ€çš„mdæ–‡ä»¶ï¼Œä½¿ç”¨<code>vscode</code>ç¼–è¾‘ï¼š<br><img src= "/blog/img/loading.gif" data-src="https://cdn.gongsir.club/blog/img/2020-12-17-1.png" alt="vscodeç¼–å†™md"></p></li><li><p>ç”Ÿæˆé™æ€ç½‘é¡µæ–‡ä»¶ï¼šä½¿ç”¨hexoçš„å‘½ä»¤å°†mdå’Œä¸»é¢˜æ ·å¼è§£ææˆhtmlæ–‡ä»¶ï¼Œå¹¶ä¿å­˜åœ¨<code>public/</code>ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure></li><li><p>è¿è¡Œæ–¹å¼ï¼š</p><ol><li>å› ä¸ºç”Ÿæˆçš„æ˜¯é™æ€htmlï¼Œå› æ­¤å¯ä»¥ç›´æ¥æ‰“å¼€<code>public/</code>ï¼ŒåŒå‡»<code>index.html</code>è¿è¡Œï¼›</li><li>ä½¿ç”¨<code>hexo s | hexo s --debug (debugæ¨¡å¼)</code>.</li></ol></li></ol><h3 id="åšå®¢éƒ¨ç½²"><a href="#åšå®¢éƒ¨ç½²" class="headerlink" title="åšå®¢éƒ¨ç½²"></a>åšå®¢éƒ¨ç½²</h3><p>å°†ç”Ÿæˆçš„<code>public/</code>ç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶ï¼ˆhtmlã€csssã€jsç­‰ï¼‰ç›´æ¥éƒ¨ç½²åˆ°ä½ çš„æœåŠ¡å™¨ï¼ˆå¯ä»¥ä½¿ç”¨scpã€ftpç­‰æœåŠ¡ï¼‰ï¼Œå†é…ç½®nginxå³å¯è®¿é—®.<br><br>ä½†æ˜¯è¿™æ ·å¾ˆéº»çƒ¦ï¼Œæ¯æ¬¡å†™ä¸€ç¯‡ï¼Œéƒ½éœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><code>hexo clean</code>: æ¸…é™¤<code>public/</code>ç¼“å­˜;</li><li><code>hexo g</code>: é‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶ï¼›</li><li>æ‰‹åŠ¨éƒ¨ç½²åˆ°ä½ çš„æœåŠ¡å™¨.</li></ol><p>å…¶å®æˆ‘ä»¬ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼Œå½“æˆ‘ä»¬å†™å®Œä¸€ç¯‡åšå®¢ä¹‹åï¼Œç›´æ¥å°†ä»£ç pushåˆ°æ‰˜ç®¡å¹³å°ï¼Œä¹‹åå°±å¯ä»¥è‡ªåŠ¨è§£æã€è‡ªåŠ¨éƒ¨ç½².å¦‚ä½•å®ç°? çœ‹åç»­â€¦ â€¦</p><h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><ul><li>Hexoå®˜æ–¹æ–‡æ¡£ï¼š<a href="https://hexo.io/zh-cn/docs/">è¿™é‡Œå¯ä»¥ä»é›¶å¼€å§‹å­¦ä¹ hexo</a></li><li>hexo-theme-blankï¼š<a href="https://dmx.pub/">è¿™é‡Œå¯ä»¥å­¦ä¹ hexo-theme-blankçš„è¯¦ç»†é…ç½®</a></li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> åŸåˆ› </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
            <tag> hexo-theme-blank </tag>
            
            <tag> MyBlog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
